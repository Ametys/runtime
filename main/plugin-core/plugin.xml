<?xml version="1.0" encoding="UTF-8"?>
<!--
   Copyright 2015 Anyware Services

   Licensed under the Apache License, Version 2.0 (the "License");
   you may not use this file except in compliance with the License.
   You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

   Unless required by applicable law or agreed to in writing, software
   distributed under the License is distributed on an "AS IS" BASIS,
   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   See the License for the specific language governing permissions and
   limitations under the License.
   -->
<plugin xmlns="http://www.ametys.org/schema/plugin"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.ametys.org/schema/plugin http://www.ametys.org/schema/plugin-4.0.xsd"
        runtimeVersion="4.0" version="4.0">
	<!--
		This is the mandatory plugin included in runtime that comes with :
		<ul>
			<li>mandatory extensions points (users...),</li>
			<li>default implementations,</li>
			<li>screens for the administrator area,</li>
			<li>helpers,</li>
			<li>main database pool,</li>
			<li>...</li>
		</ul>
	 -->

    <config>
        <!-- +
             | CORE DEBUG
             + -->
        <param id="runtime.cache.xslt" type="boolean">
            <!-- 
                This parameter allows to deactivate XSLT cache
             -->
            <label i18n="true">PLUGINS_CORE_CACHE_XSLT_LABEL</label>
            <description i18n="true">PLUGINS_CORE_CACHE_XSLT_DESCRIPTION</description>
            <validation>
                <mandatory/>
            </validation>
            <default-value>false</default-value>
            <category i18n="true">PLUGINS_CORE_SYSTEM_CONFIG_CATEGORY</category>
            <group i18n="true">PLUGINS_CORE_DEBUG_GROUP</group>
            <order>20</order>
        </param>
        <param id="runtime.log.abnormal.time" type="boolean">
            <!-- 
                This parameter activates the trace of process taking an abnormal time in logs
             -->
            <label i18n="true">PLUGINS_CORE_TRACE_LOG_ABNORMAL_TIME_LABEL</label>
            <description i18n="true">PLUGINS_CORE_TRACE_LOG_ABNORMAL_TIME_DESCRIPTION</description>
            <validation>
                <mandatory/>
            </validation>
            <default-value>false</default-value>
            <category i18n="true">PLUGINS_CORE_SYSTEM_CONFIG_CATEGORY</category>
            <group i18n="true">PLUGINS_CORE_LOGGING_GROUP</group>
            <order>10</order>
        </param>

        <!-- +
             | UPLOAD
             + -->
        <param id="runtime.upload.max-size" type="long">
            <!-- 
                The max size of uploaded files.
             -->
            <label i18n="true">PLUGINS_CORE_UPLOAD_CONFIG_MAXSIZE_LABEL</label>
            <description i18n="true">PLUGINS_CORE_UPLOAD_CONFIG_MAXSIZE_DESCRIPTION</description>
            <validation>
                <mandatory/>
            </validation>        
            <default-value>10485760</default-value>
            <category i18n="true">PLUGINS_CORE_SYSTEM_CONFIG_CATEGORY</category>
            <group i18n="true">PLUGINS_CORE_UPLOAD_CONFIG_GROUP</group>
            <order>10</order>
        </param>
        <param id="runtime.upload.dir" type="string">
            <!-- 
                The destination directory for uploaded files.
             -->
            <label i18n="true">PLUGINS_CORE_UPLOAD_CONFIG_DIR_LABEL</label>
            <description i18n="true">PLUGINS_CORE_UPLOAD_CONFIG_DIR_DESCRIPTION</description>
            <validation>
                <mandatory/>
                <regexp>^.*[^\/]$</regexp>
                <invalidText i18n="true">PLUGINS_CORE_REGEXP_INVALID_PATH</invalidText>
            </validation>        
            <default-value>WEB-INF/data/uploads</default-value>
            <category i18n="true">PLUGINS_CORE_SYSTEM_CONFIG_CATEGORY</category>
            <group i18n="true">PLUGINS_CORE_UPLOAD_CONFIG_GROUP</group>
            <order>20</order>
        </param>
        
        <!-- +
             | MAIL - ADDRESSES
             + -->
        <param type="string" id="smtp.mail.from">
            <!-- This parameter contains the "from" address used as default sender -->
            <label i18n="true">PLUGINS_CORE_MAIL_CONFIG_FROM_ADDRESS</label>
            <description i18n="true">PLUGINS_CORE_MAIL_CONFIG_FROM_ADDRESS_DESCRIPTION</description>
            <validation>
                <mandatory/>
                <regexp>^((\w+)([\-+.][\w]+)*@(\w[\-\w]*\.){1,5}([A-Za-z0-9][A-Za-z0-9]+))|([^&lt;]+&lt;(\w+)([\-+.][\w]+)*@(\w[\-\w]*\.){1,5}([A-Za-z0-9][A-Za-z0-9]+)&gt;)$</regexp>
                <invalidText i18n="true">PLUGINS_CORE_REGEXP_INVALID_MAIL</invalidText>
            </validation>
            <default-value>sender@ametys.org</default-value>
            <category i18n="true">PLUGINS_CORE_MAIL_CONFIG_CATEGORY</category>
            <group i18n="true">PLUGINS_CORE_MAIL_CONFIG_ADDRESS_GROUP</group>
            <order>1</order>
        </param>
        <param type="string" id="smtp.mail.sysadminto">
            <!-- This parameter contains the email address of the system administrator for alert purposes -->
            <label i18n="true">PLUGINS_CORE_MAIL_CONFIG_SYSADMINTO_ADDRESS</label>
            <description i18n="true">PLUGINS_CORE_MAIL_CONFIG_SYSADMINTO_ADDRESS_DESCRIPTION</description>
            <validation>
                <regexp>^(\w+)([\-+.][\w]+)*@(\w[\-\w]*\.){1,5}([A-Za-z0-9][A-Za-z0-9]+)$</regexp>
                <invalidText i18n="true">PLUGINS_CORE_REGEXP_INVALID_MAIL</invalidText>
            </validation>
            <category i18n="true">PLUGINS_CORE_MAIL_CONFIG_CATEGORY</category>
            <group i18n="true">PLUGINS_CORE_MAIL_CONFIG_ADDRESS_GROUP</group>
            <order>2</order>
        </param>
        
        <!-- +
             | MAIL - SERVER PARAMETERS
             + -->
        <param type="string" id="smtp.mail.host">
        	<!-- This parameter contains the server name for sending mail -->
            <label i18n="true">PLUGINS_CORE_MAIL_CONFIG_HOST</label>
            <description i18n="true">PLUGINS_CORE_MAIL_CONFIG_HOST_DESCRIPTION</description>
            <validation>
            	<mandatory/>
        	</validation>
            <category i18n="true">PLUGINS_CORE_MAIL_CONFIG_CATEGORY</category>
            <group i18n="true">PLUGINS_CORE_MAIL_CONFIG_GROUP</group>
            <order>1</order>
        </param>
        <param type="long" id="smtp.mail.port">
        	<!-- This parameter contains the server port for sending mail. Defaults to 25. -->
            <label i18n="true">PLUGINS_CORE_MAIL_CONFIG_PORT</label>
            <description i18n="true">PLUGINS_CORE_MAIL_CONFIG_PORT_DESCRIPTION</description>
            <default-value>25</default-value>
            <category i18n="true">PLUGINS_CORE_MAIL_CONFIG_CATEGORY</category>
            <group i18n="true">PLUGINS_CORE_MAIL_CONFIG_GROUP</group>
            <order>2</order>
        </param>
        <param type="string" id="smtp.mail.security.protocol">
            <!-- This parameter contains the security protocol to be used to send e-mails. Defaults to None. -->
            <label i18n="true">PLUGINS_CORE_MAIL_CONFIG_SECURITY_LABEL</label>
            <description i18n="true">PLUGINS_CORE_MAIL_CONFIG_SECURITY_DESCRIPTION</description>
            <enumeration>
                <entry>
                    <label i18n="true">PLUGINS_CORE_MAIL_CONFIG_SECURITY_NONE</label>
                    <value>none</value>
                </entry>
                <entry>
                    <label i18n="true">PLUGINS_CORE_MAIL_CONFIG_SECURITY_STARTTLS</label>
                    <value>starttls</value>
                </entry>
                <entry>
                    <label i18n="true">PLUGINS_CORE_MAIL_CONFIG_SECURITY_TLSSSL</label>
                    <value>tlsssl</value>
                </entry>
            </enumeration>
            <default-value>none</default-value>
            <category i18n="true">PLUGINS_CORE_MAIL_CONFIG_CATEGORY</category>
            <group i18n="true">PLUGINS_CORE_MAIL_CONFIG_GROUP</group>
            <order>3</order>
        </param>
        <param type="string" id="smtp.mail.user">
        	<!-- This parameter contains the user's login for sending mail -->
            <label i18n="true">PLUGINS_CORE_MAIL_CONFIG_USER</label>
            <description i18n="true">PLUGINS_CORE_MAIL_CONFIG_USER_DESCRIPTION</description>
            <category i18n="true">PLUGINS_CORE_MAIL_CONFIG_CATEGORY</category>
            <group i18n="true">PLUGINS_CORE_MAIL_CONFIG_GROUP</group>
            <order>4</order>
        </param>
        <param type="password" id="smtp.mail.password">
        	<!-- This parameter contains the user's password for sending mail -->
            <label i18n="true">PLUGINS_CORE_MAIL_CONFIG_PASSWORD</label>
            <description i18n="true">PLUGINS_CORE_MAIL_CONFIG_PASSWORD_DESCRIPTION</description>
            <category i18n="true">PLUGINS_CORE_MAIL_CONFIG_CATEGORY</category>
            <group i18n="true">PLUGINS_CORE_MAIL_CONFIG_GROUP</group>
            <order>5</order>
        </param>
        
       <param-checker id="mail-connection-checker" class="org.ametys.plugins.core.impl.checker.MailConnectionChecker">
            <label i18n="true">PLUGINS_CORE_MAIL_CONNECTION_CHECKER_LABEL</label>
            <description i18n="true">PLUGINS_CORE_MAIL_CONNECTION_CHECKER_DESC</description>
            
            <icon-small>img/config/check/test_emailconnect_16.png</icon-small>
            <icon-medium>img/config/check/test_emailconnect_32.png</icon-medium>
            <icon-large>img/config/check/test_emailconnect_48.png</icon-large>
                        
            <ui-ref>
                <order>5</order>
                <category i18n="true">PLUGINS_CORE_MAIL_CONFIG_CATEGORY</category>
                <group i18n="true">PLUGINS_CORE_MAIL_CONFIG_GROUP</group>
            </ui-ref>
            
            <linked-params>
                <param-ref id="smtp.mail.host"/>
                <param-ref id="smtp.mail.port"/>
                <param-ref id="smtp.mail.security.protocol"/>
                <param-ref id="smtp.mail.user"/>
                <param-ref id="smtp.mail.password"/>
            </linked-params>
        </param-checker>
        
        <!--param-checker id="send-mail-checker" class="org.ametys.plugins.core.impl.parameter.checker.SendMailChecker">
            <label i18n="true">PLUGINS_CORE_SEND_MAIL_CHECKER_LABEL</label>
            <description i18n="true">PLUGINS_CORE_SEND_MAIL_CHECKER_DESC</description>
            <icon plugin="core">img/config/check/test_mailsend.png</icon>
                        
            <ui-ref>
                <order>1</order>
                <category i18n="true">PLUGINS_CORE_MAIL_CONFIG_CATEGORY</category>
            </ui-ref>
            
            <linked-params>
                <param-ref id="smtp.mail.host"/>
                <param-ref id="smtp.mail.port"/>
                <param-ref id="smtp.mail.security.protocol"/>
                <param-ref id="smtp.mail.user"/>
                <param-ref id="smtp.mail.password"/>
                <param-ref id="smtp.mail.from"/>
                <param-ref id="smtp.mail.sysadminto"/>
            </linked-params>
        </param-checker-->
    
        <param-checker id="upload-directory-checker" class="org.ametys.plugins.core.impl.checker.DirectoryChecker">
            <label i18n="true">PLUGINS_CORE_UPLOAD_DIRECTORY_CHECKER_LABEL</label>
            <description i18n="true">PLUGINS_CORE_UPLOAD_DIRECTORY_CHECKER_DESC</description>
            <icon-large>img/config/check/test_directorywrite_48.png</icon-large>
            <icon-medium>img/config/check/test_directorywrite_32.png</icon-medium>
            <icon-small>img/config/check/test_directorywrite_16.png</icon-small>
                       
            <configuration>
                <check-write/>
                <creates-if-required/>
            </configuration>
                        
            <ui-ref>
                <order>1</order>
                <param-ref id="runtime.upload.dir"/>
            </ui-ref>
            
            <linked-params>
                <param-ref id="runtime.upload.dir"/>
            </linked-params>
        </param-checker>
    </config>
    
    <extension-points>

        <extension-point id="org.ametys.runtime.plugin.InitExtensionPoint"
                         class="org.ametys.runtime.plugin.InitExtensionPoint"/>
                         
        <extension-point id="org.ametys.core.authentication.AuthenticationManager"
                         class="org.ametys.core.authentication.AuthenticationManager"
                         safe="true"/>
                         
        <extension-point id="org.ametys.core.right.RightsExtensionPoint"
                         class="org.ametys.core.right.RightsExtensionPoint"
                         safe="true"/>
                         
        <extension-point id="org.ametys.core.right.RightContextConvertorExtentionPoint"
        				 class="org.ametys.core.right.RightContextConvertorExtentionPoint"/>
        
        <extension-point id="org.ametys.core.userpref.UserPreferencesExtensionPoint"
                         class="org.ametys.core.userpref.UserPreferencesExtensionPoint"
                         logger="org.ametys.core.userpref.UserPreferencesExtensionPoint"
                         safe="true"/>
        
        <extension-point id="org.apache.cocoon.components.modules.input.InputModuleSelector"
                         class="org.ametys.core.cocoon.InputModulesExtensionPoint"
                         safe="true"/>

        <extension-point id="org.apache.excalibur.source.SourceFactorySelector"
                         class="org.ametys.core.cocoon.SourceFactoriesExtensionPoint"
                         safe="true"/>

        <extension-point id="org.ametys.core.datasource.DataSourceExtensionPoint"
                         class="org.ametys.core.datasource.DataSourceExtensionPoint"/>

        <extension-point id="org.ametys.runtime.cocoon.SitemapConfigurationExtensionPoint"
                         class="org.ametys.runtime.cocoon.SitemapConfigurationExtensionPoint"
                         safe="true"/>

        <extension-point id="org.ametys.core.cocoon.XHTMLSerializerExtensionPoint"
                         class="org.ametys.core.cocoon.XHTMLSerializerExtensionPoint"
                         safe="true"/>
                         
        <extension-point id="org.ametys.core.observation.ObserverExtensionPoint"
                         class="org.ametys.core.observation.ObserverExtensionPoint">
            <!-- Observer extension point -->
        </extension-point>
    </extension-points>
    
    <feature name="util.servercommhelper" safe="true">
    	<components>
    		<component role="org.ametys.core.util.ServerCommHelper"
    				   id="org.ametys.core.util.ServerCommHelper"
    				   class="org.ametys.core.util.ServerCommHelper" />
    	</components>
    </feature>
    
    <feature name="util.jsonutils" safe="true">
    	<components>
    		<component role="org.ametys.core.util.JSONUtils"
    				   id="org.ametys.core.util.JSONUtils"
    				   class="org.ametys.core.util.JSONUtils" />
    				   
    		<component role="org.ametys.core.util.I18nizableTextSerializer"
    				   id="org.ametys.core.util.I18nizableTextSerializer"
    				   class="org.ametys.core.util.I18nizableTextSerializer" />
    	</components>
    </feature>
    
    <feature name="util.i18n.bundlefactory">
        <components>
            <component role="org.apache.cocoon.i18n.BundleFactory"
                       id="org.apache.cocoon.i18n.BundleFactory"
                       class="org.ametys.core.cocoon.XMLResourceBundleFactory" />
        </components>
    </feature>
    
    <feature name="util.i18nutils" safe="true">
        <components>
            <component role="org.ametys.core.util.I18nUtils"
                       id="org.ametys.core.util.I18nUtils"
                       class="org.ametys.core.util.I18nUtils"/>
        </components>
    </feature>
    
    <!-- +
         |  EXCEPTION
         + -->
    <feature name="runtime.exception.impl.default">
        <!-- 
            This feature has the default behavior on errors that display the embeded error pages.
         -->
        <components>
            <component role="org.ametys.runtime.exception.ExceptionHandler"
                       id="org.ametys.plugins.core.exception.Default"
                       class="org.ametys.runtime.exception.DefaultExceptionHandler"
                       logger="org.ametys.runtime.exception.default"/>
        </components>
    </feature>
    
    
    <feature name="xhtmlserializer-empty" safe="true">
      	<extensions>
    		<extension id="org.ametys.core.cocoon.XHTMLSerializerExtensionPoint.empty" point="org.ametys.core.cocoon.XHTMLSerializerExtensionPoint">
                <!-- Add the empty namespace as allowed for the xhtml serialization -->
    		    			<namespace-allowed></namespace-allowed>
    		</extension>
    	</extensions>
    </feature>
    <feature name="xhtmlserializer-xhtml" safe="true">
    	<extensions>
    		<extension id="org.ametys.core.cocoon.XHTMLSerializerExtensionPoint.xhtml" point="org.ametys.core.cocoon.XHTMLSerializerExtensionPoint">
                <!-- Add the xhtml namespace as allowed for the xhtml serialization -->
    		    <namespace-allowed>http://www.w3.org/1999/xhtml</namespace-allowed>
    		</extension>
    	</extensions>
    </feature>
    <feature name="xhtmlserializer-xml" safe="true">
    	<extensions>
    		<extension id="org.ametys.core.cocoon.XHTMLSerializerExtensionPoint.xml" point="org.ametys.core.cocoon.XHTMLSerializerExtensionPoint">
                <!-- Add the xml namespace as allowed for the xhtml serialization -->
    		    <namespace-allowed>http://www.w3.org/XML/1998/namespace</namespace-allowed>
    		</extension>
    	</extensions>
    </feature>
    <feature name="xhtmlserializer-svg" safe="true">
    	<extensions>
    		<extension id="org.ametys.core.cocoon.XHTMLSerializerExtensionPoint.svg" point="org.ametys.core.cocoon.XHTMLSerializerExtensionPoint">
                <!-- Add the svg namespace as allowed for the xhtml serialization -->
    		    <namespace-allowed>http://www.w3.org/2000/svg</namespace-allowed>
    		</extension>
    	</extensions>
    </feature>
    <feature name="xhtmlserializer-mathml" safe="true">
    	<extensions>
    		<extension id="org.ametys.core.cocoon.XHTMLSerializerExtensionPoint.mathml" point="org.ametys.core.cocoon.XHTMLSerializerExtensionPoint">
                <!-- Add the mathml namespace as allowed for the xhtml serialization -->
    		    <namespace-allowed>http://www.w3.org/1998/Math/MathML</namespace-allowed>
    		</extension>
    	</extensions>
    </feature>
    
    <feature name="runtime.core" safe="true">
        <!-- 
            This feature is a mandatory feature of the runtime defining basic tools
         -->
        <components>
            <component role="org.ametys.runtime.request.RequestListenerManager" 
                       id="org.ametys.runtime.request.RequestListenerManager" 
                       class="org.ametys.runtime.request.RequestListenerManager"/>
            
            <component role="org.apache.excalibur.source.SourceResolver" 
                       id="org.apache.excalibur.source.SourceResolver" 
                       class="org.apache.excalibur.source.impl.SourceResolverImpl"/>
                       
            <component role="org.apache.excalibur.xml.xslt.XSLTProcessor/xalan"
                       id="org.apache.excalibur.xml.xslt.XSLTProcessor/xalan"
                       class="org.ametys.runtime.cocoon.ThreadSafeTraxProcessor" >
                <parameter name="incremental-processing" value="false"/>
                <parameter name="transformer-factory" value="org.apache.xalan.processor.TransformerFactoryImpl"/>
            </component>
        </components>
        
        <extensions>
            <extension point="org.apache.cocoon.components.modules.input.InputModuleSelector"
                       id="config"
                       class="org.ametys.runtime.config.ConfigInputModule"
                       logger="org.ametys.runtime.config.ConfigInputModule"/>
            <extension point="org.apache.cocoon.components.modules.input.InputModuleSelector"
                       id="parent-context-attr"
                       class="org.ametys.core.util.cocoon.ParentContextInputModule"
                       logger="org.ametys.core.util.cocoon.ParentContextInputModule"/>
            <extension point="org.apache.cocoon.components.modules.input.InputModuleSelector"
                       id="context-attr"
                       class="org.ametys.core.util.cocoon.ContextAttributesInputModule"
                       logger="org.ametys.core.util.cocoon.ContextAttributesInputModule"/>
                       
            <extension point="org.ametys.runtime.cocoon.SitemapConfigurationExtensionPoint"
                       id="sitemap.base_generators">
            
                <generator name="file" src="org.ametys.core.cocoon.RuntimeFileGenerator" label="content" logger="org.ametys.runtime.kernel.sitemap.generator.file" pool-grow="4" pool-max="32" pool-min="8"/>
                <generator name="action-result" src="org.ametys.core.cocoon.ActionResultGenerator" label="content" logger="org.ametys.runtime.kernel.sitemap.generator.actionresult" pool-grow="4" pool-max="32" pool-min="8"/>
            </extension>
            
            <extension point="org.ametys.core.authentication.AuthenticationManager"
                       id="org.ametys.plugins.core.impl.authentication.UsersManagerAuthentication"
                       class="org.ametys.plugins.core.impl.authentication.UsersManagerAuthentication"
                       logger="org.ametys.plugins.core.impl.authentication.UsersManagerAuthentication"/>
                       
            <!-- Mixed source users manager authentication. To be used with CASBasicCredentialsProvider. -->
            <extension point="org.ametys.core.authentication.AuthenticationManager"
                       id="org.ametys.plugins.core.impl.authentication.mixed.MixedSourceUsersManagerAuthentication"
                       class="org.ametys.plugins.core.impl.authentication.mixed.MixedSourceUsersManagerAuthentication"
                       logger="org.ametys.plugins.core.impl.authentication.mixed.MixedSourceUsersManagerAuthentication"/>
                       
            <extension point="org.ametys.core.authentication.AuthenticationManager"
                       id="org.ametys.plugins.core.impl.authentication.HasRightAuthentication"
                       class="org.ametys.plugins.core.impl.authentication.HasRightAuthentication"
                       logger="org.ametys.plugins.core.impl.authentication.HasRightAuthentication"/>
        </extensions>
    </feature>
    
    <feature name="runtime.core.has_right_sitemap_components">
        <extensions>
            <extension point="org.ametys.runtime.cocoon.SitemapConfigurationExtensionPoint"
                        id="sitemap.has_right_components">
            
                <action name="has-not-right" src="org.ametys.plugins.core.right.HasRightAction" logger="org.ametys.plugins.core.right">
                    <has-right>false</has-right>
                    <base-context>/application</base-context>
                </action>
                <action name="has-right" src="org.ametys.plugins.core.right.HasRightAction" logger="org.ametys.plugins.core.right">
                    <has-right>true</has-right>
                    <base-context>/application</base-context>
                </action>
                        
            </extension>
        </extensions>
    </feature>

    <feature name="runtime.upload">
        <!-- Mark thoses configuration parameters as necessary. If you do not want to configure this beacause your application does not upload any file => unactive this feature. -->
        <config>
            <param-ref id="runtime.upload.max-size"/>
            <param-ref id="runtime.upload.dir"/>
        </config>
    </feature>
    
    <feature name="runtime.debug">
        <!-- Mark the UI debug parameter as available. If your application does not handle it you can unativate it. -->
        <config>
            <param-ref id="runtime.cache.xslt"/>
            <param-ref id="runtime.log.abnormal.time"/>
		</config>
	</feature>
    
    
    <feature name="runtime.util.ldap.scope.enumerator">
        <!-- 
            This feature provides a LDAP scope enumerator
         -->
    	<components>
    		<component role="org.ametys.core.util.ldap.ScopeEnumerator"
    		           id="org.ametys.core.util.ldap.ScopeEnumerator"
    		           class="org.ametys.core.util.ldap.ScopeEnumerator"/>
    	</components>
    </feature>
    
    <feature name="runtime.sending.mail">
        <!-- 
            This feature provides configuration parameters for sending mail
         -->
        <config>
            <param-ref id="smtp.mail.host"/>
            <param-ref id="smtp.mail.port"/>
            <param-ref id="smtp.mail.security.protocol"/>
            <param-ref id="smtp.mail.user"/>
            <param-ref id="smtp.mail.password"/>
            <param-ref id="smtp.mail.from"/>
            <param-ref id="smtp.mail.sysadminto"/>
        </config>
    </feature>
        
    <feature name="core.user.preferences.manager" safe="true">
        <components>
            <component role="org.ametys.core.userpref.UserPreferencesManager"
                       id="org.ametys.core.userpref.UserPreferencesManager"
                       class="org.ametys.core.userpref.UserPreferencesManager"
                       logger="org.ametys.core.userpref.UserPreferencesManager">
                <default-storage-role>org.ametys.core.userpref.DefaultUserPreferencesStorage</default-storage-role>
            </component>
        </components>
    </feature>

    <feature name="core.observation">       
        <components>
            <component role="org.ametys.core.observation.ObservationManager"
                       id="org.ametys.core.observation.ObservationManager"
                       class="org.ametys.core.observation.ObservationManager">
                <!-- Manager for dispatching Event instances to Observers -->
            </component>
        </components>
    </feature>
    
    <feature name="xslt.helpers" safe="true">
        <components>
            <component id="org.ametys.core.util.AmetysXSLTHelper"
                       role="org.ametys.core.util.AmetysXSLTHelper"
                       class="org.ametys.core.util.AmetysXSLTHelper"/>
        </components>
    </feature>
    
    <feature name="core.rights.client-interaction">
        <components>
            <component role="org.ametys.plugins.core.right.UsersClientInteraction"
                       id="org.ametys.plugins.core.right.UsersClientInteraction"
                       class="org.ametys.plugins.core.right.UsersClientInteraction"/>
                       
            <component role="org.ametys.plugins.core.right.ProfilesClientInteraction"
                       id="org.ametys.plugins.core.right.ProfilesClientInteraction"
                       class="org.ametys.plugins.core.right.ProfilesClientInteraction"/>
        </components>
    </feature>
    
    <feature name="core.users">

        <components>
            <component class="org.ametys.plugins.core.user.UserDAO" 
                       role="org.ametys.plugins.core.user.UserDAO" 
                       id="org.ametys.plugins.core.user.UserDAO"/>
        </components>
        
        <extensions>
            <extension point="org.ametys.core.right.RightsExtensionPoint"
                       id="org.ametys.core.users.right">
                <right id="Runtime_Rights_User_Handle">
                    <label>PLUGINS_CORE_RIGHTS_USERS_LABEL</label>
                    <description>PLUGINS_CORE_RIGHTS_USERS_DESCRIPTION</description>
                    <category>PLUGINS_CORE_USERANDRIGHTS_CATEGORY</category>
                </right>
            </extension>
            
            <extension id="org.ametys.core.Users"
                       point="org.ametys.core.ui.RibbonControlsManager"
                       class="org.ametys.core.ui.StaticClientSideElement">
                <class name="Ametys.ribbon.element.ui.button.OpenToolButtonController">
                    <opentool-role>uitool-users</opentool-role>
                    <label i18n="true">PLUGINS_CORE_UITOOL_USERS_LABEL</label>
                    <description i18n="true">PLUGINS_CORE_UITOOL_USERS_DESCRIPTION</description>
                    <help>org.ametys.core.users</help>
                    <icon-small file="true">img/users/user_16.png</icon-small>
                    <icon-medium file="true">img/users/user_32.png</icon-medium>
                    <icon-large file="true">img/users/user_48.png</icon-large>
                </class>
                <right>Runtime_Rights_User_Handle</right>
            </extension>
            
            <extension id="org.ametys.core.UsersFactory"
                       point="org.ametys.core.ui.UIToolsFactoriesManager"
                       class="org.ametys.core.ui.StaticClientSideElement">
                <class name="Ametys.tool.factory.UniqueToolFactory">
                    <role>uitool-users</role>
                    <toolClass>Ametys.plugins.core.users.UsersTool</toolClass>
                    
                    <title i18n="true">PLUGINS_CORE_UITOOL_USERS_LABEL</title>
                    <description i18n="true">PLUGINS_CORE_UITOOL_USERS_DESCRIPTION</description>
                    <help>org.ametys.core.users</help>
                    <icon-small file="true">img/users/user_16.png</icon-small>
                    <icon-medium file="true">img/users/user_32.png</icon-medium>
                    <icon-large file="true">img/users/user_48.png</icon-large>
                    <default-location></default-location>
                </class>
                <scripts>
                    <file>js/Ametys/plugins/core/users/UsersDAO.js</file>
                    <file>js/Ametys/plugins/core/users/UsersTool.js</file>
                    <file>js/Ametys/plugins/core/users/UsersTool/User.js</file>
                </scripts>
            </extension>
            
            <extension id="org.ametys.core.rights.UserTab"
                       point="org.ametys.core.ui.RibbonTabsManager"
                       class="org.ametys.core.ui.StaticClientSideElement">
                <class name="Ametys.ribbon.element.tab.TabController">
                    <tool-role>^(uitool-users|user-rights-.+)$</tool-role>
                </class> 
            </extension> 
            
            <extension id="org.ametys.core.users.Add"
                       point="org.ametys.core.ui.RibbonControlsManager"
                       class="org.ametys.plugins.core.user.ModifiableUsersClientSideElement">
                <class name="Ametys.ribbon.element.ui.ButtonController">
                    <action>Ametys.plugins.core.users.UsersActions.add</action>
                    <users-tool-role>uitool-users</users-tool-role>
                    <label i18n="true">PLUGINS_CORE_USERS_ADD_LABEL</label>
                    <default-description i18n="true">PLUGINS_CORE_USERS_ADD_DESCRIPTION</default-description>
                    <icon-small file="true">img/users/add_16.png</icon-small>
                    <icon-medium file="true">img/users/add_32.png</icon-medium>
                    <icon-large file="true">img/users/add_48.png</icon-large>
                </class>
                <scripts>
                    <file>js/Ametys/plugins/core/users/UsersDAO.js</file>
                    <file>js/Ametys/plugins/core/users/UsersActions.js</file>
                    <file>js/Ametys/plugins/core/users/EditUserHelper.js</file>
                </scripts>
                <right>Runtime_Rights_User_Handle</right>
            </extension>
            
            <extension id="org.ametys.core.users.Edit"
                       point="org.ametys.core.ui.RibbonControlsManager"
                       class="org.ametys.plugins.core.user.ModifiableUsersClientSideElement">
                <class name="Ametys.ribbon.element.ui.ButtonController">
                    <action>Ametys.plugins.core.users.UsersActions.modify</action>
                    <selection-target-type>^user$</selection-target-type>
                    
                    <label i18n="true">PLUGINS_CORE_USERS_EDIT_LABEL</label>
                    <default-description i18n="true">PLUGINS_CORE_USERS_EDIT_DESCRIPTION</default-description>
                    <icon-small file="true">img/users/modify_16.png</icon-small>
                    <icon-medium file="true">img/users/modify_32.png</icon-medium>
                    <icon-large file="true">img/users/modify_48.png</icon-large>
                </class>
                <scripts>
                    <file>js/Ametys/plugins/core/users/UsersDAO.js</file>
                    <file>js/Ametys/plugins/core/users/UsersActions.js</file>
                    <file>js/Ametys/plugins/core/users/EditUserHelper.js</file>
                </scripts>
                <right>Runtime_Rights_User_Handle</right>
            </extension>
            
            <extension id="org.ametys.core.users.Delete"
                       point="org.ametys.core.ui.RibbonControlsManager"
                       class="org.ametys.plugins.core.user.ModifiableUsersClientSideElement">
                <class name="Ametys.ribbon.element.ui.ButtonController">
                    <action>Ametys.plugins.core.users.UsersActions.delete</action>
                    <selection-target-type>^user$</selection-target-type>

                    <label i18n="true">PLUGINS_CORE_USERS_DELETE_LABEL</label>
                    <default-description i18n="true">PLUGINS_CORE_USERS_DELETE_DESCRIPTION</default-description>
                    <icon-small file="true">img/users/delete_16.png</icon-small>
                    <icon-medium file="true">img/users/delete_32.png</icon-medium>
                    <icon-large file="true">img/users/delete_48.png</icon-large>
                </class>
                <scripts>
                    <file>js/Ametys/plugins/core/users/UsersDAO.js</file>
                    <file>js/Ametys/plugins/core/users/UsersActions.js</file>
                </scripts>
                <right>Runtime_Rights_User_Handle</right>
            </extension>
            
            <extension id="org.ametys.core.users.Rights"
                       point="org.ametys.core.ui.RibbonControlsManager"
                       class="org.ametys.core.ui.StaticClientSideElement">
                <class name="Ametys.ribbon.element.ui.button.OpenToolButtonController">
                    <opentool-role>uitool-user-rights</opentool-role>
                    <label i18n="true">PLUGINS_CORE_UITOOL_USER_RIGHTS_LABEL</label>
                    <description i18n="true">PLUGINS_CORE_UITOOL_USER_RIGHTS_DESCRIPTION</description>
                    <selection-target-type>^user$</selection-target-type>
                    <selection-description-empty i18n="true">PLUGINS_CORE_UITOOL_USER_RIGHTS_EMPTY</selection-description-empty>
                    <selection-description-nomatch i18n="true">PLUGINS_CORE_UITOOL_USER_RIGHTS_EMPTY</selection-description-nomatch>
                    <selection-description-multiselectionforbidden i18n="true">PLUGINS_CORE_UITOOL_USER_RIGHTS_MULTI_FORBIDDEN</selection-description-multiselectionforbidden>
                    <help>org.ametys.core.users.rights</help>
                    <icon-small file="true">img/users/rights_16.png</icon-small>
                    <icon-medium file="true">img/users/rights_32.png</icon-medium>
                    <icon-large file="true">img/users/rights_48.png</icon-large>
                </class>
                <right>Runtime_Rights_User_Handle</right>
            </extension>
            
            <extension id="org.ametys.core.users.Impersonate"
                       point="org.ametys.core.ui.RibbonControlsManager"
                       class="org.ametys.plugins.core.user.ImpersonateUserClientSideElement">
                <class name="Ametys.ribbon.element.ui.ButtonController">
                    <action>Ametys.plugins.core.users.UsersActions.impersonate</action>

                    <label i18n="true">PLUGINS_CORE_USERS_IMPERSONATE_LABEL</label>
                    <description i18n="true">PLUGINS_CORE_USERS_IMPERSONATE_DESCRIPTION</description>
                    
                    <selection-target-type>^user$</selection-target-type>
                    <selection-enable-multiselection>false</selection-enable-multiselection>
                    <selection-description-multiselectionforbidden i18n="true">PLUGINS_CORE_USERS_IMPERSONATE_MULTI_FORBIDDEN</selection-description-multiselectionforbidden>

                    <help>org.ametys.core.users.rights</help>
                    <icon-small file="true">img/users/impersonate_16.png</icon-small>
                    <icon-medium file="true">img/users/impersonate_32.png</icon-medium>
                    <icon-large file="true">img/users/impersonate_48.png</icon-large>
                </class>
                <script>
                    <file>js/Ametys/plugins/core/users/UsersActions.js</file>
                </script>
            </extension>
            
            <extension id="org.ametys.core.UserRightsFactory"
                       point="org.ametys.core.ui.UIToolsFactoriesManager"
                       class="org.ametys.core.ui.StaticClientSideElement">
                <class name="Ametys.tool.factory.UniqueToolFactory">
                    <role>uitool-user-rights</role>
                    <toolClass>Ametys.plugins.core.users.UserRightsTool</toolClass>
                    
                    <title i18n="true">PLUGINS_CORE_UITOOL_USER_RIGHTS_LABEL</title>
                    <description i18n="true">PLUGINS_CORE_UITOOL_USER_RIGHTS_DESCRIPTION</description>
                    <selection-target-type>^user$</selection-target-type>
                    <selection-description-empty i18n="true">PLUGINS_CORE_UITOOL_USER_RIGHTS_EMPTY</selection-description-empty>
                    <selection-description-nomatch i18n="true">PLUGINS_CORE_UITOOL_USER_RIGHTS_EMPTY</selection-description-nomatch>
                    <selection-description-multiselectionforbidden i18n="true">PLUGINS_CORE_UITOOL_USER_RIGHTS_MULTI_FORBIDDEN</selection-description-multiselectionforbidden>
                    <help>org.ametys.core.users.rights</help>
                    <icon-small file="true">img/users/rights_16.png</icon-small>
                    <icon-medium file="true">img/users/rights_32.png</icon-medium>
                    <icon-large file="true">img/users/rights_48.png</icon-large>
                    <default-location>r</default-location>
                </class>
                <scripts>
                    <file>js/Ametys/plugins/core/users/UserRightsTool.js</file>
                </scripts>
            </extension>
            
            <extension id="org.ametys.core.relations.addusers"
                   point="org.ametys.core.ui.RelationsManager"
                   class="org.ametys.core.ui.StaticClientSideElement">
                <class name="Ametys.plugins.core.relations.UserGroupRelationHandler">
                    <label i18n="true">PLUGINS_CORE_RELATIONS_ADD_USER_LABEL</label>
                    <description i18n="true">PLUGINS_CORE_RELATIONS_ADD_USER_DESCRIPTION</description>
                    <icon-small file="true">img/users/add_16.png</icon-small>
                    <icon-medium file="true">img/users/add_32.png</icon-medium>
                    <icon-large file="true">img/users/add_48.png</icon-large>
                </class>
                <scripts>
                    <file>js/Ametys/plugins/core/relations/UserGroupRelationHandler.js</file>
                </scripts>
            </extension>
        </extensions>
    </feature>
    
    <!-- +
         | GROUPS
         + -->
    <feature name="core.groups">
        <components>
            <component class="org.ametys.plugins.core.group.GroupDAO" role="org.ametys.plugins.core.group.GroupDAO" id="org.ametys.plugins.core.group.GroupDAO"></component>
        </components>
        
        <extensions>
            <extension point="org.ametys.core.right.RightsExtensionPoint"
                       id="org.ametys.core.groups.right">
                <right id="Runtime_Rights_Group_Handle">
                    <label>PLUGINS_CORE_RIGHTS_GROUPS_LABEL</label>
                    <description>PLUGINS_CORE_RIGHTS_GROUPS_DESCRIPTION</description>
                    <category>PLUGINS_CORE_USERANDRIGHTS_CATEGORY</category>
                </right>
            </extension>
            
            <extension id="org.ametys.core.Groups"
                       point="org.ametys.core.ui.RibbonControlsManager"
                       class="org.ametys.core.ui.StaticClientSideElement">
                <class name="Ametys.ribbon.element.ui.button.OpenToolButtonController">
                    <opentool-role>uitool-groups</opentool-role>
                    <label i18n="true">PLUGINS_CORE_UITOOL_GROUPS_LABEL</label>
                    <description i18n="true">PLUGINS_CORE_UITOOL_GROUPS_DESCRIPTION</description>
                    <help>org.ametys.core.groups</help>
                    <icon-small file="true">img/groups/group_16.png</icon-small>
                    <icon-medium file="true">img/groups/group_32.png</icon-medium>
                    <icon-large file="true">img/groups/group_50.png</icon-large>
                </class>
                <right context-prefix="/contributor">Runtime_Rights_Group_Handle</right>
            </extension>
            
            <extension id="org.ametys.core.GroupsFactory"
                       point="org.ametys.core.ui.UIToolsFactoriesManager"
                       class="org.ametys.core.ui.StaticClientSideElement">
                <class name="Ametys.tool.factory.UniqueToolFactory">
                    <role>uitool-groups</role>
                    <toolClass>Ametys.plugins.core.groups.GroupsTool</toolClass>
                    
                    <title i18n="true">PLUGINS_CORE_UITOOL_GROUPS_LABEL</title>
                    <description i18n="true">PLUGINS_CORE_UITOOL_GROUPS_DESCRIPTION</description>
                    <help>org.ametys.core.groups</help>
                    <icon-small file="true">img/groups/group_16.png</icon-small>
                    <icon-medium file="true">img/groups/group_32.png</icon-medium>
                    <icon-large file="true">img/groups/group_50.png</icon-large>
                    <default-location></default-location>
                </class>
                <scripts>
                    <file>js/Ametys/plugins/core/groups/GroupsDAO.js</file>
                    <file>js/Ametys/plugins/core/groups/GroupsTool.js</file>
                    <file>js/Ametys/plugins/core/groups/GroupsTool/Group.js</file>
                    <file>js/Ametys/plugins/core/groups/GroupsTool/UserGroup.js</file>
                </scripts>
            </extension>
            
            <extension id="org.ametys.core.rights.GroupTab"
                       point="org.ametys.core.ui.RibbonTabsManager"
                       class="org.ametys.core.ui.StaticClientSideElement">
                <class name="Ametys.ribbon.element.tab.TabController">
                    <tool-role>uitool-groups</tool-role>
                </class> 
            </extension>
            
            <extension id="org.ametys.core.groups.Add"
                       point="org.ametys.core.ui.RibbonControlsManager"
                       class="org.ametys.plugins.core.group.ModifiableGroupsClientSideElement">
                <class name="Ametys.ribbon.element.ui.ButtonController">
                    <action>Ametys.plugins.core.groups.GroupsActions.add</action>
                    <label i18n="true">PLUGINS_CORE_GROUPS_ADD_LABEL</label>
                    <description i18n="true">PLUGINS_CORE_GROUPS_ADD_DESCRIPTION</description>
                    <icon-small file="true">img/groups/add_16.png</icon-small>
                    <icon-medium file="true">img/groups/add_32.png</icon-medium>
                    <icon-large file="true">img/groups/add_50.png</icon-large>
                </class>
                <scripts>
                    <file>js/Ametys/plugins/core/groups/GroupsDAO.js</file>
                    <file>js/Ametys/plugins/core/groups/GroupsActions.js</file>
                    <file>js/Ametys/plugins/core/groups/EditGroupHelper.js</file>
                </scripts>
                <right>Runtime_Rights_Group_Handle</right>
            </extension>
            
            <extension id="org.ametys.core.groups.Edit"
                       point="org.ametys.core.ui.RibbonControlsManager"
                       class="org.ametys.plugins.core.group.ModifiableGroupsClientSideElement">
                <class name="Ametys.ribbon.element.ui.ButtonController">
                    <action>Ametys.plugins.core.groups.GroupsActions.edit</action>
                    <selection-target-type>^group$</selection-target-type>
                    
                    <label i18n="true">PLUGINS_CORE_GROUPS_RENAME_LABEL</label>
                    <description i18n="true">PLUGINS_CORE_GROUPS_RENAME_DESCRIPTION</description>
                    <icon-small file="true">img/groups/rename_16.png</icon-small>
                    <icon-medium file="true">img/groups/rename_32.png</icon-medium>
                    <icon-large file="true">img/groups/rename_50.png</icon-large>
                </class>
                <scripts>   
                    <file>js/Ametys/plugins/core/groups/GroupsDAO.js</file>
                    <file>js/Ametys/plugins/core/groups/GroupsActions.js</file>
                    <file>js/Ametys/plugins/core/groups/EditGroupHelper.js</file>
                </scripts>
                <right>Runtime_Rights_Group_Handle</right>
            </extension>
            
            <extension id="org.ametys.core.groups.Delete"
                       point="org.ametys.core.ui.RibbonControlsManager"
                       class="org.ametys.plugins.core.group.ModifiableGroupsClientSideElement">
                <class name="Ametys.ribbon.element.ui.ButtonController">
                    <action>Ametys.plugins.core.groups.GroupsActions.delete</action>
                    <selection-target-type>^group$</selection-target-type>
                    
                    <label i18n="true">PLUGINS_CORE_GROUPS_DELETE_LABEL</label>
                    <description i18n="true">PLUGINS_CORE_GROUPS_DELETE_DESCRIPTION</description>
                    <icon-small file="true">img/groups/delete_16.png</icon-small>
                    <icon-medium file="true">img/groups/delete_32.png</icon-medium>
                    <icon-large file="true">img/groups/delete_50.png</icon-large>
                </class>
                <scripts>
                    <file>js/Ametys/plugins/core/groups/GroupsDAO.js</file>
                    <file>js/Ametys/plugins/core/groups/GroupsActions.js</file>
                </scripts>
                <right>Runtime_Rights_Group_Handle</right>
            </extension>
            
            <extension id="org.ametys.core.groups.AddUsers"
                       point="org.ametys.core.ui.RibbonControlsManager"
                       class="org.ametys.plugins.core.group.ModifiableGroupsClientSideElement">
                <class name="Ametys.ribbon.element.ui.ButtonController">
                    <action>Ametys.plugins.core.groups.GroupsActions.addUsers</action>
                    <selection-target-type>^group$</selection-target-type>

                    <label i18n="true">PLUGINS_CORE_GROUPS_ADDUSERS_LABEL</label>
                    <description i18n="true">PLUGINS_CORE_GROUPS_ADDUSERS_DESCRIPTION</description>
                    <icon-small file="true">img/users/add_16.png</icon-small>
                    <icon-medium file="true">img/users/add_32.png</icon-medium>
                    <icon-large file="true">img/users/add_48.png</icon-large>
                </class>
                <scripts>
                    <file>js/Ametys/plugins/core/groups/GroupsDAO.js</file>
                    <file>js/Ametys/plugins/core/groups/GroupsActions.js</file>
                </scripts>
                <right>Runtime_Rights_Group_Handle</right>
            </extension>
            
            <extension id="org.ametys.core.groups.RemoveUsers"
                       point="org.ametys.core.ui.RibbonControlsManager"
                       class="org.ametys.plugins.core.group.ModifiableGroupsClientSideElement">
                <class name="Ametys.ribbon.element.ui.ButtonController">
                    <action>Ametys.plugins.core.groups.GroupsActions.removeUsers</action>
                    <selection-target-type>^group$</selection-target-type>
                    <selection-subtarget-type>^user$</selection-subtarget-type>
                    
                    <label i18n="true">PLUGINS_CORE_GROUPS_REMOVEUSERS_LABEL</label>
                    <description i18n="true">PLUGINS_CORE_GROUPS_REMOVEUSERS_DESCRIPTION</description>
                    <icon-small file="true">img/users/delete_16.png</icon-small>
                    <icon-medium file="true">img/users/delete_32.png</icon-medium>
                    <icon-large file="true">img/users/delete_48.png</icon-large>
                </class>
                <scripts>
                    <file>js/Ametys/plugins/core/groups/GroupsDAO.js</file>
                    <file>js/Ametys/plugins/core/groups/GroupsActions.js</file>
                </scripts>
                <right>Runtime_Rights_Group_Handle</right>
            </extension>
        </extensions>
    </feature>
    
    <!-- +
         | PROFILES
         + -->
    <feature name="core.profiles">
        <components>
            <component class="org.ametys.plugins.core.right.profile.ProfileDAO" role="org.ametys.plugins.core.right.profile.ProfileDAO" id="org.ametys.plugins.core.right.profile.ProfileDAO"></component>
        </components>
        
        <extensions>
            <extension point="org.ametys.core.right.RightsExtensionPoint"
                       id="org.ametys.core.profiles.right">
                <right id="Runtime_Rights_Rights_Profile_See">
                    <label>PLUGINS_CORE_RIGHTS_PROFILES_SEE_LABEL</label>
                    <description>PLUGINS_CORE_RIGHTS_PROFILES_SEE_DESCRIPTION</description>
                    <category>PLUGINS_CORE_USERANDRIGHTS_CATEGORY</category>
                </right>
                <right id="Runtime_Rights_Rights_Profile_Handle">
                    <label>PLUGINS_CORE_RIGHTS_PROFILES_LABEL</label>
                    <description>PLUGINS_CORE_RIGHTS_PROFILES_DESCRIPTION</description>
                    <category>PLUGINS_CORE_USERANDRIGHTS_CATEGORY</category>
                </right>
                <right id="Runtime_Rights_Rights_Handle">
                    <label>PLUGINS_CORE_RIGHTS_HANDLE_LABEL</label>
                    <description>PLUGINS_CORE_RIGHTS_HANDLE_DESCRIPTION</description>
                    <category>PLUGINS_CORE_USERANDRIGHTS_CATEGORY</category>
                </right>
            </extension>
            
            <extension id="org.ametys.core.Profiles"
                       point="org.ametys.core.ui.RibbonControlsManager"
                       class="org.ametys.core.ui.StaticClientSideElement">
                <class name="Ametys.ribbon.element.ui.button.OpenToolButtonController">
                    <opentool-role>uitool-profiles</opentool-role>
                    <label i18n="true">PLUGINS_CORE_UITOOL_PROFILES_LABEL</label>
                    <description i18n="true">PLUGINS_CORE_UITOOL_PROFILES_DESCRIPTION</description>
                    <help>org.ametys.core.rights.profiles</help>
                    <icon-small file="true">img/profiles/profile_16.gif</icon-small>
                    <icon-medium file="true">img/profiles/profile_32.gif</icon-medium>
                    <icon-large file="true">img/profiles/profile_50.gif</icon-large>
                </class>
                <right context-prefix="/contributor">Runtime_Rights_Rights_Profile_See</right>
            </extension>
            
            <extension id="org.ametys.core.ProfilesFactory"
                       point="org.ametys.core.ui.UIToolsFactoriesManager"
                       class="org.ametys.core.ui.StaticClientSideElement">
                <class name="Ametys.tool.factory.UniqueToolFactory">
                    <role>uitool-profiles</role>
                    <toolClass>Ametys.plugins.core.profiles.ProfilesTool</toolClass>
                    
                    <title i18n="true">PLUGINS_CORE_UITOOL_PROFILES_LABEL</title>
                    <description i18n="true">PLUGINS_CORE_UITOOL_PROFILES_DESCRIPTION</description>
                    <help>org.ametys.core.rights.profiles</help>
                    <icon-small file="true">img/profiles/profile_16.gif</icon-small>
                    <icon-medium file="true">img/profiles/profile_32.gif</icon-medium>
                    <icon-large file="true">img/profiles/profile_50.gif</icon-large>
                    <default-location></default-location>
                </class>
                <scripts>
                    <file>js/Ametys/plugins/core/profiles/ProfilesDAO.js</file>
                    <file>js/Ametys/plugins/core/profiles/ProfilesTool.js</file>
                    <file>js/Ametys/plugins/core/profiles/ProfilesTool/Profile.js</file>
                    <file>js/Ametys/plugins/core/profiles/ProfilesTool/Right.js</file>
                </scripts>
            </extension>
            
            <extension id="org.ametys.core.rights.ProfileTab"
                       point="org.ametys.core.ui.RibbonTabsManager"
                       class="org.ametys.core.ui.StaticClientSideElement">
                <class name="Ametys.ribbon.element.tab.TabController">
                    <tool-role>uitool-profiles</tool-role>
                </class> 
            </extension>
            
            <extension id="org.ametys.core.profiles.Add"
                       point="org.ametys.core.ui.RibbonControlsManager"
                       class="org.ametys.plugins.core.right.profile.ProfileBasedClientSideElement">
                <class name="Ametys.ribbon.element.ui.ButtonController">
                    <action>Ametys.plugins.core.profiles.ProfilesActions.add</action>
                    
                    <label i18n="true">PLUGINS_CORE_PROFILES_ADD_LABEL</label>
                    <description i18n="true">PLUGINS_CORE_PROFILES_ADD_DESCRIPTION</description>
                    <no-right-description>PLUGINS_CORE_PROFILES_DESCRIPTION_NO_RIGHT</no-right-description>
                    
                    <icon-small file="true">img/profiles/add_16.gif</icon-small>
                    <icon-medium file="true">img/profiles/add_32.gif</icon-medium>
                    <icon-large file="true">img/profiles/add_50.gif</icon-large>
                </class>
                <scripts>
                    <file>js/Ametys/plugins/core/profiles/ProfilesDAO.js</file>
                    <file>js/Ametys/plugins/core/profiles/ProfilesActions.js</file>
                    <file>js/Ametys/plugins/core/profiles/EditProfileHelper.js</file>
                </scripts>
                <right>Runtime_Rights_Rights_Profile_Handle</right>
            </extension>
            
            <extension id="org.ametys.core.profiles.Edit"
                       point="org.ametys.core.ui.RibbonControlsManager"
                       class="org.ametys.plugins.core.right.profile.ProfileBasedClientSideElement">
                <class name="Ametys.ribbon.element.ui.ButtonController">
                    <action>Ametys.plugins.core.profiles.ProfilesActions.edit</action>
                    <selection-target-type>^profile$</selection-target-type>
                    
                    <label i18n="true">PLUGINS_CORE_PROFILES_RENAME_LABEL</label>
                    <description i18n="true">PLUGINS_CORE_PROFILES_RENAME_DESCRIPTION</description>
                    <no-selection-description i18n="true">PLUGINS_CORE_PROFILES_DESCRIPTION_NO_SELECTION</no-selection-description>
                    
                    <icon-small file="true">img/profiles/rename_16.gif</icon-small>
                    <icon-medium file="true">img/profiles/rename_32.gif</icon-medium>
                    <icon-large file="true">img/profiles/rename_50.gif</icon-large>
                </class>
                <scripts>
                    <file>js/Ametys/plugins/core/profiles/ProfilesDAO.js</file>
                    <file>js/Ametys/plugins/core/profiles/ProfilesActions.js</file>
                    <file>js/Ametys/plugins/core/profiles/EditProfileHelper.js</file>
                </scripts>
                <right>Runtime_Rights_Rights_Profile_Handle</right>
            </extension>
            
            <extension id="org.ametys.core.profiles.Delete"
                       point="org.ametys.core.ui.RibbonControlsManager"
                       class="org.ametys.plugins.core.right.profile.ProfileBasedClientSideElement">
                <class name="Ametys.ribbon.element.ui.ButtonController">
                    <action>Ametys.plugins.core.profiles.ProfilesActions.delete</action>
                    <selection-target-type>^profile$</selection-target-type>
                    
                    <label i18n="true">PLUGINS_CORE_PROFILES_DELETE_LABEL</label>
                    <description i18n="true">PLUGINS_CORE_PROFILES_DELETE_DESCRIPTION</description>
                    <no-selection-description i18n="true">PLUGINS_CORE_PROFILES_DESCRIPTION_NO_SELECTION</no-selection-description>
                    
                    <icon-small file="true">img/profiles/delete_16.gif</icon-small>
                    <icon-medium file="true">img/profiles/delete_32.gif</icon-medium>
                    <icon-large file="true">img/profiles/delete_50.gif</icon-large>
                </class>
                <scripts>
                    <file>js/Ametys/plugins/core/profiles/ProfilesDAO.js</file>
                    <file>js/Ametys/plugins/core/profiles/ProfilesActions.js</file>
                </scripts>
                <right>Runtime_Rights_Rights_Profile_Handle</right>
            </extension>
            
            <extension id="org.ametys.core.profiles.SwitchMode"
                       point="org.ametys.core.ui.RibbonControlsManager"
                       class="org.ametys.core.ui.StaticClientSideElement">
                <class name="Ametys.plugins.core.profiles.controller.ViewModeController">
                    <action>Ametys.plugins.core.profiles.ProfilesTool.switchMode</action>
                    
                    <enable-toggle>true</enable-toggle>
                    <tool-role>uitool-profile</tool-role>
                    <tool-enable-on-status>focus</tool-enable-on-status>
                    <selection-target-type>^profile$</selection-target-type>
                                        
                    <label i18n="true">PLUGINS_CORE_PROFILES_SWITCH_TO_EDITION</label>
                    <description i18n="true">PLUGINS_CORE_PROFILES_SWITCH_TO_EDITION_DESCRIPTION</description>
                    <no-selection-description i18n="true">PLUGINS_CORE_PROFILES_DESCRIPTION_NO_SELECTION</no-selection-description>
                    
                    <icon-small file="true">img/profiles/edit_16.png</icon-small>
                    <icon-medium file="true">img/profiles/edit_32.png</icon-medium>
                    <icon-large file="true">img/profiles/edit_48.png</icon-large>
                </class>
                <scripts>
                    <file>js/Ametys/plugins/core/profiles/ProfilesDAO.js</file>
                    <file>js/Ametys/plugins/core/profiles/ProfilesTool.js</file>
                    <file>js/Ametys/plugins/core/profiles/controller/ViewModeController.js</file>
                </scripts>
                <right>Runtime_Rights_Rights_Profile_Handle</right>
           </extension>
           
           <extension id="org.ametys.core.profiles.SaveRights"
                       point="org.ametys.core.ui.RibbonControlsManager"
                       class="org.ametys.core.ui.StaticClientSideElement">
                <class name="Ametys.ribbon.element.ui.ButtonController">
                    <action>Ametys.plugins.core.profiles.ProfilesTool.save</action>
                   
                    <disabled>true</disabled>
                    <selection-target-type>^profile$</selection-target-type>
                    <selection-subtarget-type>^form$</selection-subtarget-type>
                    <selection-subtarget-parameter>
                        <name>isDirty</name>
                        <value>true</value>
                    </selection-subtarget-parameter>
                    
                    <label i18n="true">PLUGINS_CORE_PROFILES_SAVE_MODIFICATIONS</label>
                    <description i18n="true">PLUGINS_CORE_PROFILES_SAVE_MODIFICATIONS_DESCRIPTION</description>
                    <no-selection-description i18n="true">PLUGINS_CORE_PROFILES_DESCRIPTION_NO_SELECTION</no-selection-description>
                    
                    <icon-small file="true">img/profiles/save_16.png</icon-small>
                    <icon-medium file="true">img/profiles/save_32.png</icon-medium>
                    <icon-large file="true">img/profiles/save_48.png</icon-large>
                </class>
                <scripts>
                    <file>js/Ametys/plugins/core/profiles/ProfilesDAO.js</file>
                    <file>js/Ametys/plugins/core/profiles/ProfilesActions.js</file>
                </scripts>
                <right>Runtime_Rights_Rights_Profile_Handle</right>
            </extension>
            
            <extension id="org.ametys.core.profiles.Discard"
                       point="org.ametys.core.ui.RibbonControlsManager"
                       class="org.ametys.core.ui.StaticClientSideElement">
                <class name="Ametys.ribbon.element.ui.ButtonController">
                    <action>Ametys.plugins.core.profiles.ProfilesTool.discardChanges</action>
                   
                    <disabled>true</disabled>
                    <selection-target-type>^profile$</selection-target-type>
                    <selection-subtarget-type>^form$</selection-subtarget-type>
                    <selection-subtarget-parameter>
                        <name>isDirty</name>
                        <value>true</value>
                    </selection-subtarget-parameter>
                    
                    <label i18n="true">PLUGINS_CORE_PROFILES_DONT_SAVE_MODIFICATIONS</label>
                    <description i18n="true">PLUGINS_CORE_PROFILES_DONT_SAVE_MODIFICATIONS_DESCRIPTION</description>
                    <no-selection-description i18n="true">PLUGINS_CORE_PROFILES_DESCRIPTION_NO_SELECTION</no-selection-description>
                    
                    <icon-small file="true">img/profiles/unsave_16.png</icon-small>
                    <icon-medium file="true">img/profiles/unsave_32.png</icon-medium>
                    <icon-large file="true">img/profiles/unsave_48.png</icon-large>
                </class>
                <scripts>
                    <file>js/Ametys/plugins/core/profiles/ProfilesDAO.js</file>
                    <file>js/Ametys/plugins/core/profiles/ProfilesActions.js</file>
                </scripts>
                <right>Runtime_Rights_Rights_Profile_Handle</right>
            </extension>
           
           <extension id="org.ametys.core.profiles.SelectAll"
                       point="org.ametys.core.ui.RibbonControlsManager"
                       class="org.ametys.core.ui.StaticClientSideElement">
                <class name="Ametys.plugins.core.profiles.controller.SelectRightsController">
                    <action>Ametys.plugins.core.profiles.ProfilesTool.selectAll</action>
                    
                    <disabled>true</disabled>
                    <selection-target-type>^profile$</selection-target-type>
                    <selection-subtarget-type>^form$</selection-subtarget-type>
                                        
                    <label i18n="true">PLUGINS_CORE_PROFILES_SELECT_ALL</label>
                    <description i18n="true">PLUGINS_CORE_PROFILES_SELECT_ALL_DESCRIPTION</description>
                    <no-selection-description i18n="true">PLUGINS_CORE_PROFILES_DESCRIPTION_NO_SELECTION</no-selection-description>
                    
                    <icon-small file="true">img/profiles/select_16.png</icon-small>
                    <icon-medium file="true">img/profiles/select_32.png</icon-medium>
                    <icon-large file="true">img/profiles/select_48.png</icon-large>
                </class>
                <scripts>
                    <file>js/Ametys/plugins/core/profiles/controller/SelectRightsController.js</file>
                    <file>js/Ametys/plugins/core/profiles/ProfilesDAO.js</file>
                    <file>js/Ametys/plugins/core/profiles/ProfilesActions.js</file>
                    <file>js/Ametys/plugins/core/profiles/ProfilesTool.js</file>
                </scripts>
                <right>Runtime_Rights_Rights_Profile_Handle</right>
            </extension>
            
           <extension id="org.ametys.core.profiles.UnselectAll"
                       point="org.ametys.core.ui.RibbonControlsManager"
                       class="org.ametys.core.ui.StaticClientSideElement">
                <class name="Ametys.plugins.core.profiles.controller.SelectRightsController">
                    <action>Ametys.plugins.core.profiles.ProfilesTool.unselectAll</action>
                    
                    <disabled>true</disabled>
                    <selection-target-type>^profile$</selection-target-type>
                    <selection-subtarget-type>^form$</selection-subtarget-type>
                    
                    <label i18n="true">PLUGINS_CORE_PROFILES_UNSELECT_ALL</label>
                    <description i18n="true">PLUGINS_CORE_PROFILES_UNSELECT_ALL_DESCRIPTION</description>
                    <no-selection-description i18n="true">PLUGINS_CORE_PROFILES_DESCRIPTION_NO_SELECTION</no-selection-description>
                    
                    <icon-small file="true">img/profiles/unselect_16.png</icon-small>
                    <icon-medium file="true">img/profiles/unselect_32.png</icon-medium>
                    <icon-large file="true">img/profiles/unselect_48.png</icon-large>
                </class>
                <scripts>
                    <file>js/Ametys/plugins/core/profiles/controller/SelectRightsController.js</file>
                    <file>js/Ametys/plugins/core/profiles/ProfilesDAO.js</file>
                    <file>js/Ametys/plugins/core/profiles/ProfilesActions.js</file>
                    <file>js/Ametys/plugins/core/profiles/ProfilesTool.js</file>
                </scripts>
                <right>Runtime_Rights_Rights_Profile_Handle</right>
            </extension>
        </extensions>
    </feature>
    
    <!-- +
         | SUPER USER
         + -->
     <feature name="core.superuser">
        <extensions>
            <extension id="org.ametys.core.superuser.Affect"
                       point="org.ametys.core.ui.RibbonControlsManager"
                       class="org.ametys.plugins.core.superuser.SuperUserClientSideElement">
                <class name="Ametys.ribbon.element.ui.ButtonController">
                    <action>Ametys.plugins.core.superuser.SuperUserActions.affectSuperUser</action>
                    
                    <label i18n="true">PLUGINS_CORE_SUPERUSER_LABEL</label>
                    <description i18n="true">PLUGINS_CORE_SUPERUSER_DESCRIPTION</description>
                    
                    <icon-small file="true">img/superuser/super_user_16.png</icon-small>
                    <icon-medium file="true">img/superuser/super_user_32.png</icon-medium>
                    <icon-large file="true">img/superuser/super_user_48.png</icon-large>
                </class>
                <scripts>
                    <file>js/Ametys/plugins/core/superuser/SuperUserActions.js</file>
                </scripts>
            </extension>
        </extensions>
     </feature>
</plugin>
