<?xml version="1.0" encoding="UTF-8"?>
<!--
   Copyright 2015 Anyware Services

   Licensed under the Apache License, Version 2.0 (the "License");
   you may not use this file except in compliance with the License.
   You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

   Unless required by applicable law or agreed to in writing, software
   distributed under the License is distributed on an "AS IS" BASIS,
   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   See the License for the specific language governing permissions and
   limitations under the License.
   -->
<plugin xmlns="http://www.ametys.org/schema/plugin"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.ametys.org/schema/plugin http://www.ametys.org/schema/plugin-4.0.xsd"
        runtimeVersion="4.0" version="4.0">
    
    <config>
        <!-- USER PREFS DATA SOURCE -->
        <param id="runtime.usersprefs.datasource" type="datasource">
            <!-- 
                This parameter contains the datasource used for the runtime user preferences
             -->
            <label i18n="true">PLUGINS_CORE_DATASOURCE_CONFIG_USERPREFS_DATASOURCE_LABEL</label>
            <description i18n="true">PLUGINS_CORE_DATASOURCE_CONFIG_USERPREFS_DATASOURCE_DESCRIPTION</description>
            <widget>edition.datasource-sql</widget>
            <widget-params>
                <param name="allowCreation">true</param>
                <param name="allowPrivate">true</param>
                <param name="allowInternal">true</param>
            </widget-params>
            <validation>
                <mandatory/>
            </validation>
            <category i18n="true">PLUGINS_CORE_DATASOURCE_CONFIG_USERPREFS_CATEGORY</category>
            <group i18n="true">PLUGINS_CORE_DATASOURCE_CONFIG_USERPREFS_GROUP</group>
        </param>
        
        <!-- RIGHTS DATA SOURCE -->
        <param id="runtime.rights.datasource" type="datasource">
            <!-- 
                This parameter contains the datasource used for the runtime user preferences
             -->
            <label i18n="true">PLUGINS_CORE_DATASOURCE_CONFIG_RIGHTS_DATASOURCE_LABEL</label>
            <description i18n="true">PLUGINS_CORE_DATASOURCE_CONFIG_RIGHTS_DATASOURCE_DESCRIPTION</description>
            <widget>edition.datasource-sql</widget>
            <widget-params>
                <param name="allowCreation">true</param>
                <param name="allowPrivate">true</param>
                <param name="allowInternal">true</param>
            </widget-params>
            <validation>
                <mandatory/>
            </validation>
            <category i18n="true">PLUGINS_CORE_DATASOURCE_CONFIG_RIGHTS_CATEGORY</category>
            <group i18n="true">PLUGINS_CORE_DATASOURCE_CONFIG_RIGHTS_GROUP</group>
        </param>
        
        <!-- LOGIN FORM DATA SOURCE -->
        <param id="runtime.login.form.datasource" type="datasource">
            <!-- 
                This parameter contains the data source to use to connect the login form database
             -->
            <label i18n="true">PLUGINS_CORE_DATASOURCE_CONFIG_LOGIN_FORM_CONFIG_DATASOURCE_LABEL</label>
            <description i18n="true">PLUGINS_CORE_DATASOURCE_CONFIG_LOGIN_FORM_CONFIG_DATASOURCE_DESCRIPTION</description>
            <widget>edition.datasource-sql</widget>
            <widget-params>
                <param name="allowCreation">true</param>
                <param name="allowPrivate">true</param>
                <param name="allowInternal">true</param>
            </widget-params>
            <validation>
                <mandatory/>
            </validation>
            <category i18n="true">PLUGINS_CORE_DATASOURCE_CONFIG_LOGIN_FORM_CONFIG_CATEGORY</category>
            <group i18n="true">PLUGINS_CORE_DATASOURCE_CONFIG_LOGIN_FORM_CONFIG_GROUP</group>
            <order>10</order>
        </param>
        
        <!-- +
             | AUTHENTICATION
             + -->
        <!-- JCIFS -->
        <param id="runtime.authentication.jcifs.production" type="boolean">
            <!-- 
                This parameter parametrize the JCIFs client in production mode or not determining which other parameters to take in account.
             -->
            <label i18n="true">PLUGINS_CORE_AUTHENTICATION_JCIFS_CONFIG_PRODUCTION_LABEL</label>
            <description i18n="true">PLUGINS_CORE_AUTHENTICATION_JCIFS_CONFIG_PRODUCTION_DESCRIPTION</description>
            <validation>
                <mandatory/>
            </validation>
            <default-value>false</default-value>
            <category i18n="true">PLUGINS_CORE_DATASOURCE_CORE_CONFIG_CATEGORY_AUTHENTICATION</category>
            <group i18n="true">PLUGINS_CORE_DATASOURCE_CORE_CONFIG_CATEGORY_AUTHENTICATION_GROUP_JCIFS</group>
            <order>10</order>
        </param>
        <param id="runtime.authentication.jcifs.clientDomain" type="string">
            <!-- 
                This parameter contains the clien domain name.
             -->
            <label i18n="true">PLUGINS_CORE_AUTHENTICATION_JCIFS_CONFIG_CLIENTDOMAIN_LABEL</label>
            <description i18n="true">PLUGINS_CORE_AUTHENTICATION_JCIFS_CONFIG_CLIENTDOMAIN_DESCRIPTION</description>
            <category i18n="true">PLUGINS_CORE_DATASOURCE_CORE_CONFIG_CATEGORY_AUTHENTICATION</category>
            <group i18n="true">PLUGINS_CORE_DATASOURCE_CORE_CONFIG_CATEGORY_AUTHENTICATION_GROUP_JCIFS</group>
            <order>20</order>
        </param>
        <param id="runtime.authentication.jcifs.netBios" type="string">
            <!-- 
                This parameter contains the ip of the net bios server
             -->
            <label i18n="true">PLUGINS_CORE_AUTHENTICATION_JCIFS_CONFIG_NETBIOS_LABEL</label>
            <description i18n="true">PLUGINS_CORE_AUTHENTICATION_JCIFS_CONFIG_NETBIOS_DESCRIPTION</description>
            <category i18n="true">PLUGINS_CORE_DATASOURCE_CORE_CONFIG_CATEGORY_AUTHENTICATION</category>
            <group i18n="true">PLUGINS_CORE_DATASOURCE_CORE_CONFIG_CATEGORY_AUTHENTICATION_GROUP_JCIFS</group>
            <order>30</order>
        </param>
        <param id="runtime.authentication.jcifs.domainController" type="string">
            <!-- 
                This parameter contains the ip of the domain controller
             -->
            <label i18n="true">PLUGINS_CORE_AUTHENTICATION_JCIFS_CONFIG_DOMAINCONTROLLER_LABEL</label>
            <description i18n="true">PLUGINS_CORE_AUTHENTICATION_JCIFS_CONFIG_DOMAINCONTROLLER_DESCRIPTION</description>
            <default-value></default-value>
            <category i18n="true">PLUGINS_CORE_DATASOURCE_CORE_CONFIG_CATEGORY_AUTHENTICATION</category>
            <group i18n="true">PLUGINS_CORE_DATASOURCE_CORE_CONFIG_CATEGORY_AUTHENTICATION_GROUP_JCIFS</group>
            <order>40</order>
        </param>
        
        <param-checker id="cas-server-checker" class="org.ametys.plugins.core.impl.checker.HttpUrlChecker">
            <label i18n="true">PLUGINS_CORE_CAS_SERVER_CHECKER_LABEL</label>
            <description i18n="true">PLUGINS_CORE_CAS_SERVER_CHECKER_DESC</description>
            <icon-large>img/config/check/test_casconnect_48.png</icon-large>
            <icon-medium>img/config/check/test_casconnect_32.png</icon-medium>
            <icon-small>img/config/check/test_casconnect_16.png</icon-small>
                        
            <configuration>
                <request>
                    <user-agent>Ametys</user-agent>
                    <method>HEAD</method>
                    <timeout>10000</timeout>
                </request>
                
                <response>
                    <code>200,301</code>
                    <header>
                        
                    </header>
                </response>
            </configuration>
                        
            <ui-ref>
                <param-ref id="runtime.authentication.cas.serverUrl"/>
            </ui-ref>
            
            <linked-params>
                <param-ref id="runtime.authentication.cas.serverUrl"/>
            </linked-params>
        </param-checker>
    </config>
    
    <feature name="runtime.user.directory.impl.static" safe="true">
        <!-- 
            This features defines the static implementation of users
        -->
        <extensions>
        	<extension id="org.ametys.plugins.core.user.directory.Static" 
        			   class="org.ametys.core.user.directory.DefaultUserDirectoryModel" 
        			   point="org.ametys.core.user.directory.UserDirectoryFactory" 
        			   logger="org.ametys.plugins.core.impl.users.static">
        		<class name="org.ametys.plugins.core.impl.user.directory.StaticUserDirectory"/>
                <label i18n="true">PLUGINS_CORE_USERS_STATIC_LABEL</label>
                <description i18n="true">PLUGINS_CORE_USERS_STATIC_DESCRIPTION</description>
                <parameters>
                	<param id="runtime.users.static.users" type="string">
			            <label i18n="true">PLUGINS_CORE_USERS_STATIC_PARAM_USERS_LABEL</label>
			            <description i18n="true">PLUGINS_CORE_USERS_STATIC_PARAM_USERS_DESCRIPTION</description>
			            <validation>
			                <mandatory/>
			            </validation>
			            <widget>edition.textarea</widget>
			            <default-value>anonymous:Anonymous:User:user@ametys.org</default-value>
			        </param>
                </parameters>
            </extension>
        </extensions>
    </feature>
    
    <feature name="runtime.user.directory.impl.jdbc" safe="true">
    	<!-- 
            This features defines the jdbc implementation of users.
            Users can be modified and authenticated through the API. .
         -->
         <extensions>
         	<extension id="org.ametys.plugins.core.user.directory.Jdbc" 
        			   class="org.ametys.core.user.directory.DefaultUserDirectoryModel" 
        			   point="org.ametys.core.user.directory.UserDirectoryFactory" 
        			   logger="org.ametys.plugins.core.impl.users.jdbc">
        		<class name="org.ametys.plugins.core.impl.user.directory.JdbcUserDirectory"/>
                <label i18n="true">PLUGINS_CORE_USERS_JDBC_LABEL</label>
                <description i18n="true">PLUGINS_CORE_USERS_JDBC_DESCRIPTION</description>
                <parameters>
                	<param id="runtime.users.jdbc.datasource" type="datasource">
			            <label i18n="true">PLUGINS_CORE_USERS_JDBC_DATASOURCE_LABEL</label>
			            <description i18n="true">PLUGINS_CORE_USERS_JDBC_DATASOURCE_DESCRIPTION</description>
			            <widget>edition.datasource-sql</widget>
			            <widget-params>
			                <param name="allowCreation">true</param>
			                <param name="allowPrivate">true</param>
			                <param name="allowInternal">true</param>
			            </widget-params>
			            <validation>
			                <mandatory/>
			            </validation>
			        </param>
			        <param id="runtime.users.jdbc.table" type="string">
			            <label i18n="true">PLUGINS_CORE_USERS_JDBC_DATASOURCE_TABLE_LABEL</label>
			            <description i18n="true">PLUGINS_CORE_USERS_JDBC_DATASOURCE_TABLE_DESCRIPTION</description>
			            <validation>
			                <mandatory/>
			            </validation>
			            <default-value>Users</default-value>
			        </param>
                </parameters>
            </extension>
        </extensions>
    </feature>
    
    <feature name="runtime.user.directory.impl.ldap">
    	<!-- 
            This feature defines the ldap implementation of users.
            Users can be authenticated through the API. 
         -->
    	<extensions>
    		<extension id="org.ametys.plugins.core.user.directory.Ldap" 
        			   class="org.ametys.core.user.directory.DefaultUserDirectoryModel" 
        			   point="org.ametys.core.user.directory.UserDirectoryFactory" 
        			   logger="org.ametys.plugins.core.user.ldap">
        		<class name="org.ametys.plugins.core.impl.user.directory.LdapUserDirectory">
        			<BaseUrl>runtime.datasource.core.ldap.baseUrl</BaseUrl>
	                <UseSSL>runtime.datasource.core.ldap.useSSL</UseSSL>
	                <BaseDN>runtime.datasource.core.ldap.baseDN</BaseDN>
	                <AuthenticationMethod>runtime.datasource.core.ldap.authMethod</AuthenticationMethod>
	                <AdminDN>runtime.datasource.core.ldap.adminDN</AdminDN>
	                <AdminPassword>runtime.datasource.core.ldap.adminPasswd</AdminPassword>
	                <AliasDereferencing>runtime.datasource.core.ldap.aliasDereferencing</AliasDereferencing>
	                <FollowReferrals>runtime.datasource.core.ldap.followReferrals</FollowReferrals>
        		</class>
                <label i18n="true">PLUGINS_CORE_USERS_LDAPUSER_LABEL</label>
                <description i18n="true">PLUGINS_CORE_USERS_LDAPUSER_DESCRIPTION</description>
                
                <parameters>
                	<param id="runtime.users.ldap.datasource" type="datasource">
                		<label i18n="true">PLUGINS_CORE_USERS_LDAPUSER_CONFIG_DATASOURCE_LABEL</label>
			            <description i18n="true">PLUGINS_CORE_USERS_LDAPUSER_CONFIG_DATASOURCE_DESCRIPTION</description>
			            <widget>edition.datasource-ldap</widget>
			            <widget-params>
			                <param name="allowCreation">true</param>
			            </widget-params>
			            <validation>
			            	<mandatory/>
			            </validation>
                	</param>
                	<param id="runtime.users.ldap.peopleDN" type="string">
			            <!-- 
			                This parameter contains the DN to append to the base DN to guide to users.
			                @see:plugin{config/runtime.datasource.core.ldap.baseDN}
			             -->
			            <label i18n="true">PLUGINS_CORE_USERS_LDAPUSER_CONFIG_PEOPLEDN_LABEL</label>
			            <description i18n="true">PLUGINS_CORE_USERS_LDAPUSER_CONFIG_PEOPLEDN_DESCRIPTION</description>
			            <default-value>ou=people</default-value>
			        </param>
			        <param id="runtime.users.ldap.baseFilter" type="string">
			            <!-- 
			                This parameter contains the filter to find users objects in the current DN.
			             -->
			            <label i18n="true">PLUGINS_CORE_USERS_LDAPUSER_CONFIG_BASEFILTER_LABEL</label>
			            <description i18n="true">PLUGINS_CORE_USERS_LDAPUSER_CONFIG_BASEFILTER_DESCRIPTION</description>
			            <validation>
			                <mandatory/>
			                <regexp>\s*\(.*\)\s*</regexp>
			            </validation>        
			            <default-value>(objectclass=*)</default-value>
			        </param>
			        <param id="runtime.users.ldap.scope" type="string">
			            <!-- 
			                This parameter determine where to look for users objects in the current DN.
			                <ul>
			                    <li>In the current DN only (object)</li>
			                    <li>In the sub branch of current DN only (one)</li>
			                    <li>In the current DN and all sub branches (sub) - low perf</li>
			                </ul>
			             -->
			            <label i18n="true">PLUGINS_CORE_USERS_LDAPUSER_CONFIG_SEARCH_SCOPE_LABEL</label>
			            <description i18n="true">PLUGINS_CORE_USERS_LDAPUSER_CONFIG_SEARCH_SCOPE_DESCRIPTION</description>
			            <enumeration>
			                <custom-enumerator class="org.ametys.core.util.ldap.ScopeEnumerator"/>
			            </enumeration>
			            <validation>
			                <mandatory/>
			            </validation>
			            <default-value>one</default-value>
			        </param>
			        <param id="runtime.users.ldap.loginAttr" type="string">
			            <!-- 
			                This parameter contains the name of the attribute on users objects handling the login
			             -->
			            <label i18n="true">PLUGINS_CORE_USERS_LDAPUSER_CONFIG_ATTR_LOGIN_LABEL</label>
			            <description i18n="true">PLUGINS_CORE_USERS_LDAPUSER_CONFIG_ATTR_LOGIN_DESCRIPTION</description>
			            <validation>
			                <mandatory/>
			            </validation>
			            <default-value>uid</default-value>
			        </param>
			        <param id="runtime.users.ldap.firstnameAttr" type="string">
			            <!-- 
			               This parameter contains the name of the attribute on users objects handling the firstname
			             -->
			            <label i18n="true">PLUGINS_CORE_USERS_LDAPUSER_CONFIG_ATTR_FIRSTNAME_LABEL</label>
			            <description i18n="true">PLUGINS_CORE_USERS_LDAPUSER_CONFIG_ATTR_FIRSTNAME_DESCRIPTION</description>
			            <default-value>givenName</default-value>
			        </param>
			        <param id="runtime.users.ldap.lastnameAttr" type="string">
			            <!-- 
			                This parameter contains the name of the attribute on users objects handling the lastname
			             -->
			            <label i18n="true">PLUGINS_CORE_USERS_LDAPUSER_CONFIG_ATTR_LASTNAME_LABEL</label>
			            <description i18n="true">PLUGINS_CORE_USERS_LDAPUSER_CONFIG_ATTR_LASTNAME_DESCRIPTION</description>
			            <validation>
			                <mandatory/>
			            </validation>
			            <default-value>sn</default-value>
			        </param>
			        <param id="runtime.users.ldap.emailAttr" type="string">
			            <!-- 
			                This parameter contains the name of the attribute on users objects handling the email
			             -->
			            <label i18n="true">PLUGINS_CORE_USERS_LDAPUSER_CONFIG_ATTR_EMAIL_LABEL</label>
			            <description i18n="true">PLUGINS_CORE_USERS_LDAPUSER_CONFIG_ATTR_EMAIL_DESCRIPTION</description>
			            <validation>
			                <mandatory/>
			            </validation>
			            <default-value>mail</default-value>
			        </param>
			        <param id="runtime.users.ldap.emailMandatory" type="boolean">
			            <!-- 
			                This parameter contains true if the email is mandatory
			             -->
			            <label i18n="true">PLUGINS_CORE_USERS_LDAPUSER_CONFIG_ATTR_EMAIL_MANDATORY_LABEL</label>
			            <description i18n="true">PLUGINS_CORE_USERS_LDAPUSER_CONFIG_ATTR_EMAIL_MANDATORY_DESCRIPTION</description>
			            <default-value>false</default-value>
			        </param>
			        <param id="runtime.users.ldap.serverSideSorting" type="boolean">
			            <!-- 
			                Parameter used to control if server-side sorting of user search results is enabled.
			             -->
			            <label i18n="true">PLUGINS_CORE_USERS_LDAPUSER_CONFIG_SERVER_SIDE_SORTING_LABEL</label>
			            <description i18n="true">PLUGINS_CORE_USERS_LDAPUSER_CONFIG_SERVER_SIDE_SORTING_DESCRIPTION</description>
			            <default-value>true</default-value>
			        </param>
			        <param-checker id="runtime.users.ldap.checker" class="org.ametys.plugins.core.impl.checker.LdapUserDirectoryChecker">
			        	<label i18n="true">PLUGINS_CORE_USERS_LDAPUSER_CHECKER_LABEL</label>
			        	<description i18n="true">PLUGINS_CORE_USERS_LDAPUSER_CHECKER_DESCRIPTION</description>
			        	
			        	<icon-small>img/config/check/test_ldapconnect_16.png</icon-small>
			            <icon-medium>img/config/check/test_ldapconnect_32.png</icon-medium>
			            <icon-large >img/config/check/test_ldapconnect_48.png</icon-large>
			            <linked-params>
			                <param-ref id="org.ametys.plugins.core.user.directory.Ldap$runtime.users.ldap.datasource"/>
			                <param-ref id="org.ametys.plugins.core.user.directory.Ldap$runtime.users.ldap.peopleDN"/>
			                <param-ref id="org.ametys.plugins.core.user.directory.Ldap$runtime.users.ldap.baseFilter"/>
			                <param-ref id="org.ametys.plugins.core.user.directory.Ldap$runtime.users.ldap.scope"/>
			                <param-ref id="org.ametys.plugins.core.user.directory.Ldap$runtime.users.ldap.loginAttr"/>
			                <param-ref id="org.ametys.plugins.core.user.directory.Ldap$runtime.users.ldap.firstnameAttr"/>
			                <param-ref id="org.ametys.plugins.core.user.directory.Ldap$runtime.users.ldap.lastnameAttr"/>
			                <param-ref id="org.ametys.plugins.core.user.directory.Ldap$runtime.users.ldap.emailAttr"/>
			                <param-ref id="org.ametys.plugins.core.user.directory.Ldap$runtime.users.ldap.emailMandatory"/>
			            </linked-params>
			        </param-checker>
                </parameters>
            </extension>
        </extensions>
    </feature>
    
    <feature name="runtime.group.directory.impl.jdbc">
    	<!-- 
            This features defines the base jdbc implementation of groups
         -->
    	<extensions>
    		<extension id="org.ametys.plugins.core.group.directory.Jdbc"
    				   class="org.ametys.core.group.directory.DefaultGroupDirectoryModel"
    				   point="org.ametys.core.group.directory.GroupDirectoryFactory"
    				   logger="org.ametys.plugins.core.impl.group.directory.jdbc">
    			<class name="org.ametys.plugins.core.impl.group.directory.jdbc.JdbcGroupDirectory"/>
    			<label i18n="true">PLUGINS_CORE_GROUPS_JDBC_LABEL</label>
    			<description i18n="true">PLUGINS_CORE_GROUPS_JDBC_DESCRIPTION</description>
    			<parameters>
    				<param id="runtime.groups.jdbc.datasource" type="datasource">
			            <label i18n="true">PLUGINS_CORE_GROUPS_JDBC_DATASOURCE_LABEL</label>
			            <description i18n="true">PLUGINS_CORE_GROUPS_JDBC_DATASOURCE_DESCRIPTION</description>
			            <widget>edition.datasource-sql</widget>
			            <widget-params>
			                <param name="allowCreation">true</param>
			                <param name="allowPrivate">true</param>
			                <param name="allowInternal">true</param>
			            </widget-params>
			            <validation>
			                <mandatory/>
			            </validation>
			        </param>
			        <param id="runtime.groups.jdbc.list.table" type="string">
			        	<label i18n="true">PLUGINS_CORE_GROUPS_JDBC_DATASOURCE_LIST_TABLE_LABEL</label>
			            <description i18n="true">PLUGINS_CORE_GROUPS_JDBC_DATASOURCE_LIST_TABLE_DESCRIPTION</description>
			            <validation>
			                <mandatory/>
			            </validation>
			            <default-value>Groups</default-value>
			        </param>
			        <param id="runtime.groups.jdbc.composition.table" type="string">
			        	<label i18n="true">PLUGINS_CORE_GROUPS_JDBC_DATASOURCE_COMPOSITION_TABLE_LABEL</label>
			            <description i18n="true">PLUGINS_CORE_GROUPS_JDBC_DATASOURCE_COMPOSITION_TABLE_DESCRIPTION</description>
			            <validation>
			                <mandatory/>
			            </validation>
			            <default-value>Groups_Users</default-value>
			        </param>
    			</parameters>
    		</extension>
    	</extensions>
    </feature>
    
    <feature name="runtime.group.directory.impl.ldap.groupDriven">
    	<!-- 
            This features defines the base ldap implementation of groups where the group information is handle by the group object
         -->
    	<extensions>
    		<extension id="org.ametys.plugins.core.group.directory.GroupDrivenLdap"
    				   class="org.ametys.core.group.directory.DefaultGroupDirectoryModel"
    				   point="org.ametys.core.group.directory.GroupDirectoryFactory"
    				   logger="org.ametys.plugins.core.impl.group.directory.ldap.groupdriven">
    			<class name="org.ametys.plugins.core.impl.group.directory.ldap.GroupDrivenLdapGroupDirectory"/>
    			<label i18n="true">PLUGINS_CORE_GROUPS_LDAP_GROUP_DRIVEN_LABEL</label>
    			<description i18n="true">PLUGINS_CORE_GROUPS_LDAP_GROUP_DRIVEN_DESCRIPTION</description>
    			<parameters>
    				<param id="runtime.groups.ldap.datasource" type="datasource">
			            <label i18n="true">PLUGINS_CORE_GROUPS_LDAP_DATASOURCE_LABEL</label>
			            <description i18n="true">PLUGINS_CORE_GROUPS_LDAP_DATASOURCE_DESCRIPTION</description>
			            <widget>edition.datasource-ldap</widget>
			            <widget-params>
			                <param name="allowCreation">true</param>
			            </widget-params>
			            <validation>
			                <mandatory/>
			            </validation>
			        </param>
			        <param id="runtime.groups.ldap.population" type="string">
			        	<!--
			        		The id of the associated user population where to retrieve the users of the group. 
			        	 -->
			        	 <label i18n="true">PLUGINS_CORE_GROUPS_LDAP_POPULATION_LABEL</label>
			        	 <description i18n="true">PLUGINS_CORE_GROUPS_LDAP_POPULATION_DESCRIPTION</description>
			        	 <widget>edition.userpopulation</widget>
			        	 <validation>
			        	 	<mandatory/>
			        	 </validation>
			        </param>
			        <param id="runtime.groups.ldap.groupDN" type="string">
			        	<!-- 
			                This parameter the DN to append to the base DN to guide to groups.
			                @see:plugin{config/runtime.datasource.core.ldap.baseDN}
			             -->
			        	<label i18n="true">PLUGINS_CORE_GROUPS_LDAPGROUP_CONFIG_GROUPDN_LABEL</label>
			            <description i18n="true">PLUGINS_CORE_GROUPS_LDAPGROUP_CONFIG_GROUPDN_LABEL</description>
			            <default-value>ou=groups</default-value>
			        </param>
			        <param id="runtime.groups.ldap.filter" type="string">
			        	<!-- 
			                This parameter contains the filter to find groups objects in the current DN.
			             -->
			        	<label i18n="true">PLUGINS_CORE_GROUPS_LDAPGROUP_CONFIG_FILTER_LABEL</label>
			            <description i18n="true">PLUGINS_CORE_GROUPS_LDAPGROUP_CONFIG_FILTER_DESCRIPTION</description>
			            <validation>
			                <mandatory/>
			                <regexp>\s*\(.*\)\s*</regexp>
			            </validation>
			            <default-value>(objectclass=groupOfNames)</default-value>
			        </param>
			        <param id="runtime.groups.ldap.scope" type="string">
				        <!-- 
			                This parameter determine where to look for groups objects in the current DN.
			                <ul>
			                    <li>In the current DN only (object)</li>
			                    <li>In the sub branch of current DN only (one)</li>
			                    <li>In the current DN and all sub branches (sub) - low perf</li>
			                </ul>
			             -->
			        	<label i18n="true">PLUGINS_CORE_GROUPS_LDAPGROUP_CONFIG_SEARCH_SCOPE_LABEL</label>
			            <description i18n="true">PLUGINS_CORE_GROUPS_LDAPGROUP_CONFIG_SEARCH_SCOPE_DESCRIPTION</description>
			            <enumeration>
			                <custom-enumerator class="org.ametys.core.util.ldap.ScopeEnumerator"/>
			            </enumeration>
			            <validation>
			                <mandatory/>
			            </validation>
			            <default-value>one</default-value>
			        </param>
			        <param id="runtime.groups.ldap.id" type="string">
			        	<!-- 
			                This parameter contains the name of the attribute on groups objects handling the identifier
			             -->
			        	<label i18n="true">PLUGINS_CORE_GROUPS_LDAPGROUP_CONFIG_ID_LABEL</label>
			            <description i18n="true">PLUGINS_CORE_GROUPS_LDAPGROUP_CONFIG_ID_DESCRIPTION</description>
			             <validation>
			                <mandatory/>
			            </validation>
			            <default-value>cn</default-value>
			        </param>
			        <param id="runtime.groups.ldap.description" type="string">
				        <!-- 
			                This parameter contains the name of the attribute on groups objects handling the description (or readable name)
			             -->
			        	<label i18n="true">PLUGINS_CORE_GROUPS_LDAPGROUP_CONFIG_DESCRIPTION_LABEL</label>
			            <description i18n="true">PLUGINS_CORE_GROUPS_LDAPGROUP_CONFIG_DESCRIPTION_DESCRIPTION</description>
			            <validation>
			                <mandatory/>
			            </validation>
			            <default-value>description</default-value>
			        </param>
			        <param id="runtime.groups.ldap.member" type="string">
			        	<!-- 
			                This parameter contains the name of the attribute on groups objects handling the assocation with users.<br/>
			                This attribute is multiple and will contain the login of users.<br/>
			                A user can be part of several groups.
			                @see:plugin{config/runtime.users.ldap.peopleDN}
			                @see:plugin{config/runtime.users.ldap.loginAttr}
			             -->
			        	<label i18n="true">PLUGINS_CORE_GROUPS_LDAPGROUP_CONFIG_MEMBER_LABEL</label>
			            <description i18n="true">PLUGINS_CORE_GROUPS_LDAPGROUP_CONFIG_MEMBER_DESCRIPTION</description>
			            <validation>
			                <mandatory/>
			            </validation>
			            <default-value>member</default-value>
			        </param>
			        <param id="runtime.users.ldap.peopleDN" type="string">
			        	<!-- 
			                This parameter contains the DN to append to the base DN to guide to users.
			                @see:plugin{config/runtime.datasource.core.ldap.baseDN}
			             -->
			        	<label i18n="true">PLUGINS_CORE_USERS_LDAPUSER_CONFIG_PEOPLEDN_LABEL</label>
			            <description i18n="true">PLUGINS_CORE_USERS_LDAPUSER_CONFIG_PEOPLEDN_DESCRIPTION</description>
			            <default-value>ou=people</default-value>
			        </param>
			        <param id="runtime.users.ldap.loginAttr" type="string">
				        <!-- 
			                This parameter contains the name of the attribute on users objects handling the login
			             -->
			        	<label i18n="true">PLUGINS_CORE_USERS_LDAPUSER_CONFIG_ATTR_LOGIN_LABEL</label>
			            <description i18n="true">PLUGINS_CORE_USERS_LDAPUSER_CONFIG_ATTR_LOGIN_DESCRIPTION</description>
			            <validation>
			                <mandatory/>
			            </validation>
			            <default-value>uid</default-value>
			        </param>
    			</parameters>
    		</extension>
    	</extensions>
    </feature>
    
    <feature name="runtime.group.directory.impl.ldap.usersDriven">
    	<!-- 
            This features defines the base ldap implementation of groups where the group information is handle by the user object
         -->
    	<extensions>
    		<extension id="org.ametys.plugins.core.group.directory.UsersDrivenLdap"
    				   class="org.ametys.core.group.directory.DefaultGroupDirectoryModel"
    				   point="org.ametys.core.group.directory.GroupDirectoryFactory"
    				   logger="org.ametys.plugins.core.impl.group.directory.ldap.usersdriven">
    			<class name="org.ametys.plugins.core.impl.group.directory.ldap.UserDrivenLdapGroupDirectory"/>
    			<label i18n="true">PLUGINS_CORE_GROUPS_LDAP_USERS_DRIVEN_LABEL</label>
    			<description i18n="true">PLUGINS_CORE_GROUPS_LDAP_USERS_DRIVEN_DESCRIPTION</description>
    			<parameters>
    				<param id="runtime.groups.ldap.datasource" type="datasource">
			            <label i18n="true">PLUGINS_CORE_GROUPS_LDAP_DATASOURCE_LABEL</label>
			            <description i18n="true">PLUGINS_CORE_GROUPS_LDAP_DATASOURCE_DESCRIPTION</description>
			            <widget>edition.datasource-ldap</widget>
			            <widget-params>
			                <param name="allowCreation">true</param>
			            </widget-params>
			            <validation>
			                <mandatory/>
			            </validation>
			        </param>
			        <param id="runtime.groups.ldap.population" type="string">
			        	<!--
			        		The id of the associated user population where to retrieve the users of the group. 
			        	 -->
			        	 <label i18n="true">PLUGINS_CORE_GROUPS_LDAP_POPULATION_LABEL</label>
			        	 <description i18n="true">PLUGINS_CORE_GROUPS_LDAP_POPULATION_DESCRIPTION</description>
			        	 <widget>edition.userpopulation</widget>
			        	 <validation>
			        	 	<mandatory/>
			        	 </validation>
			        </param>
			        <param id="runtime.groups.ldap.groupDN" type="string">
			        	<!-- 
			                This parameter the DN to append to the base DN to guide to groups.
			                @see:plugin{config/runtime.datasource.core.ldap.baseDN}
			             -->
			        	<label i18n="true">PLUGINS_CORE_GROUPS_LDAPGROUP_CONFIG_GROUPDN_LABEL</label>
			            <description i18n="true">PLUGINS_CORE_GROUPS_LDAPGROUP_CONFIG_GROUPDN_LABEL</description>
			            <default-value>ou=groups</default-value>
			        </param>
			        <param id="runtime.groups.ldap.filter" type="string">
			        	<!-- 
			                This parameter contains the filter to find groups objects in the current DN.
			             -->
			        	<label i18n="true">PLUGINS_CORE_GROUPS_LDAPGROUP_CONFIG_FILTER_LABEL</label>
			            <description i18n="true">PLUGINS_CORE_GROUPS_LDAPGROUP_CONFIG_FILTER_DESCRIPTION</description>
			            <validation>
			                <mandatory/>
			                <regexp>\s*\(.*\)\s*</regexp>
			            </validation>
			            <default-value>(objectclass=groupOfNames)</default-value>
			        </param>
			        <param id="runtime.groups.ldap.scope" type="string">
				        <!-- 
			                This parameter determine where to look for groups objects in the current DN.
			                <ul>
			                    <li>In the current DN only (object)</li>
			                    <li>In the sub branch of current DN only (one)</li>
			                    <li>In the current DN and all sub branches (sub) - low perf</li>
			                </ul>
			             -->
			        	<label i18n="true">PLUGINS_CORE_GROUPS_LDAPGROUP_CONFIG_SEARCH_SCOPE_LABEL</label>
			            <description i18n="true">PLUGINS_CORE_GROUPS_LDAPGROUP_CONFIG_SEARCH_SCOPE_DESCRIPTION</description>
			            <enumeration>
			                <custom-enumerator class="org.ametys.core.util.ldap.ScopeEnumerator"/>
			            </enumeration>
			            <validation>
			                <mandatory/>
			            </validation>
			            <default-value>one</default-value>
			        </param>
			        <param id="runtime.groups.ldap.id" type="string">
			        	<!-- 
			                This parameter contains the name of the attribute on groups objects handling the identifier
			             -->
			        	<label i18n="true">PLUGINS_CORE_GROUPS_LDAPGROUP_CONFIG_ID_LABEL</label>
			            <description i18n="true">PLUGINS_CORE_GROUPS_LDAPGROUP_CONFIG_ID_DESCRIPTION</description>
			             <validation>
			                <mandatory/>
			            </validation>
			            <default-value>cn</default-value>
			        </param>
			        <param id="runtime.groups.ldap.description" type="string">
				        <!-- 
			                This parameter contains the name of the attribute on groups objects handling the description (or readable name)
			             -->
			        	<label i18n="true">PLUGINS_CORE_GROUPS_LDAPGROUP_CONFIG_DESCRIPTION_LABEL</label>
			            <description i18n="true">PLUGINS_CORE_GROUPS_LDAPGROUP_CONFIG_DESCRIPTION_DESCRIPTION</description>
			            <validation>
			                <mandatory/>
			            </validation>
			            <default-value>description</default-value>
			        </param>
			        <param id="runtime.groups.ldap.memberof" type="string">
				        <!-- 
			                This parameter contains the name of the attribute on users objects (implying users to be handled in LDAP also) 
			                handling the reverse association to the groups.
			                If this attribute is multiple a user can be part of several groups.
			                @see:plugin{config/runtime.users.ldap.peopleDN}
			                @see:plugin{config/runtime.users.ldap.baseFilter}
			                @see:plugin{config/runtime.users.ldap.scope}
			                @see:plugin{config/runtime.users.ldap.loginAttr}
			             -->
			        	<label i18n="true">PLUGINS_CORE_GROUPS_LDAPGROUP_CONFIG_MEMBEROF_LABEL</label>
			            <description i18n="true">PLUGINS_CORE_GROUPS_LDAPGROUP_CONFIG_MEMBEROF_DESCRIPTION</description>
			            <validation>
			                <mandatory/>
			            </validation>
			            <default-value>memberof</default-value>
			        </param>
			        <param id="runtime.users.ldap.peopleDN" type="string">
			        	<!-- 
			                This parameter contains the DN to append to the base DN to guide to users.
			                @see:plugin{config/runtime.datasource.core.ldap.baseDN}
			             -->
			        	<label i18n="true">PLUGINS_CORE_USERS_LDAPUSER_CONFIG_PEOPLEDN_LABEL</label>
			            <description i18n="true">PLUGINS_CORE_USERS_LDAPUSER_CONFIG_PEOPLEDN_DESCRIPTION</description>
			            <default-value>ou=people</default-value>
			        </param>
			        <param id="runtime.users.ldap.baseFilter" type="string">
			        	<!-- 
			                This parameter contains the filter to find users objects in the current DN.
			             -->
			        	<label i18n="true">PLUGINS_CORE_USERS_LDAPUSER_CONFIG_BASEFILTER_LABEL</label>
			            <description i18n="true">PLUGINS_CORE_USERS_LDAPUSER_CONFIG_BASEFILTER_DESCRIPTION</description>
			            <validation>
			                <mandatory/>
			                <regexp>\s*\(.*\)\s*</regexp>
			            </validation>        
			            <default-value>(objectclass=*)</default-value>
			        </param>
			        <param id="runtime.users.ldap.scope" type="string">
			        	<!-- 
			                This parameter determine where to look for users objects in the current DN.
			                <ul>
			                    <li>In the current DN only (object)</li>
			                    <li>In the sub branch of current DN only (one)</li>
			                    <li>In the current DN and all sub branches (sub) - low perf</li>
			                </ul>
			             -->
			        	<label i18n="true">PLUGINS_CORE_USERS_LDAPUSER_CONFIG_SEARCH_SCOPE_LABEL</label>
			            <description i18n="true">PLUGINS_CORE_USERS_LDAPUSER_CONFIG_SEARCH_SCOPE_DESCRIPTION</description>
			            <enumeration>
			                <custom-enumerator class="org.ametys.core.util.ldap.ScopeEnumerator"/>
			            </enumeration>
			            <validation>
			                <mandatory/>
			            </validation>
			            <default-value>one</default-value>
			        </param>
			        <param id="runtime.users.ldap.loginAttr" type="string">
				        <!-- 
			                This parameter contains the name of the attribute on users objects handling the login
			             -->
			        	<label i18n="true">PLUGINS_CORE_USERS_LDAPUSER_CONFIG_ATTR_LOGIN_LABEL</label>
			            <description i18n="true">PLUGINS_CORE_USERS_LDAPUSER_CONFIG_ATTR_LOGIN_DESCRIPTION</description>
			            <validation>
			                <mandatory/>
			            </validation>
			            <default-value>uid</default-value>
			        </param>
    			</parameters>
    		</extension>
    	</extensions>
    </feature>
    
    <feature name="runtime.authentication.impl.defined" safe="true">
    	<!-- 
            This feature defines a simple credential provider as it always answer that the given parameterized user (default to 'anonymous') is connected
         -->
        <extensions>
        	<extension id="org.ametys.core.authentication.Defined"
        			   class="org.ametys.core.authentication.DefaultCredentialProviderModel"
        			   point="org.ametys.core.authentication.CredentialProviderFactory"
        			   logger="org.ametys.plugins.core.impl.authentication.defined">
        		<class name="org.ametys.plugins.core.impl.authentication.DefinedCredentialProvider"/>
        		<label i18n="true">PLUGINS_CORE_AUTHENTICATION_DEFINED_LABEL</label>
        		<description i18n="true">PLUGINS_CORE_AUTHENTICATION_DEFINED_DESCRIPTION</description>
        		<parameters>
        			<param id="runtime.authentication.defined.user" type="string">
        				<label i18n="true">PLUGINS_CORE_AUTHENTICATION_DEFINED_CONFIG_USER_LABEL</label>
        				<description i18n="true">PLUGINS_CORE_AUTHENTICATION_DEFINED_CONFIG_USER_DESCRIPTION</description>
        				<validation>
        					<mandatory/>
        				</validation>
        				<default-value>anonymous</default-value>
        			</param>
        		</parameters>
        	</extension>
        </extensions>
    </feature>
    
    <feature name="runtime.authentication.impl.basic" safe="true">
    	<!-- 
            This feature defines the 'basic' credential provider (i.e. where the credential is requested to the user
            by the navigator - the incomming values are not trusted)
         -->
    	<extensions>
        	<extension id="org.ametys.core.authentication.Basic"
        			   class="org.ametys.core.authentication.DefaultCredentialProviderModel"
        			   point="org.ametys.core.authentication.CredentialProviderFactory"
        			   logger="org.ametys.plugins.core.impl.authentication.basic">
        		<class name="org.ametys.plugins.core.impl.authentication.BasicCredentialProvider"/>
        		<label i18n="true">PLUGINS_CORE_AUTHENTICATION_BASIC_LABEL</label>
        		<description i18n="true">PLUGINS_CORE_AUTHENTICATION_BASIC_DESCRIPTION</description>
        		<label-connection i18n="true">PLUGINS_CORE_AUTHENTICATION_BASIC_CONNECTION_LABEL</label-connection>
        		<icon-glyph>flaticon-external-link</icon-glyph>
        		<color>173D7C</color>
        		<parameters>
        			<param id="runtime.authentication.basic.realm" type="string">
        				<!-- 
			                This parameter contains the realm name
			             -->
			            <label i18n="true">PLUGINS_CORE_AUTHENTICATION_BASIC_CONFIG_REALM_LABEL</label>
			            <description i18n="true">PLUGINS_CORE_AUTHENTICATION_BASIC_CONFIG_REALM_DESCRIPTION</description>
			            <validation>
			                <mandatory/>
			            </validation>
			            <default-value>Application domain name</default-value>
			        </param>
        		</parameters>
        	</extension>
        </extensions>
    </feature>
    
    <feature name="runtime.authentication.impl.formbased">
    	<!-- 
            This features defines the form based credential provider. Data are sent to the provider through a
            html form. If the option is enabled, user's data can be stored with a cookie.
         -->
    	<extensions>
        	<extension id="org.ametys.core.authentication.FormBased"
        			   class="org.ametys.core.authentication.DefaultCredentialProviderModel"
        			   point="org.ametys.core.authentication.CredentialProviderFactory"
        			   logger="org.ametys.plugins.core.impl.authentication.formbased">
        		<class name="org.ametys.plugins.core.impl.authentication.FormCredentialProvider">
	        		<username-field>Username</username-field>
	                <password-field>Password</password-field>
	                <rememberMe-field>rememberMe</rememberMe-field>
	                <captchaKey-field>CaptchaKey</captchaKey-field>
	                <captcha-field>Captcha</captcha-field>
	                <cookie>
	                    <cookieEnabled>true</cookieEnabled>
	                    <cookieLifeTime>604800</cookieLifeTime>
	                    <cookieName>AmetysAuthentication</cookieName>
	                </cookie>
	                <!-- <loginUrl internal="true">_plugins/core-impl/login.html</loginUrl> -->
	                <loginUrl internal="true">_plugins/core/login.html</loginUrl>
	                <!-- <loginFailedUrl provideLoginParameter="true" internal="true">_plugins/core-impl/login_failed.html</loginFailedUrl> -->
	                <loginFailedUrl provideLoginParameter="true" internal="true">_plugins/core/login_failed.html</loginFailedUrl>
        		</class>
        		<label i18n="true">PLUGINS_CORE_AUTHENTICATION_FORMBASED_LABEL</label>
        		<description i18n="true">PLUGINS_CORE_AUTHENTICATION_FORMBASED_DESCRIPTION</description>
        		<label-connection i18n="true">PLUGINS_CORE_AUTHENTICATION_FORMBASED_CONNECTION_LABEL</label-connection>
        		<icon-glyph>flaticon-key162</icon-glyph>
        		<color>804080</color>
                
        		<parameters>
        			<param id="runtime.authentication.form.security.level" type="string">
        				<!-- This parameter defines the security level of the login. -->
			            <label i18n="true">PLUGINS_CORE_SECURITY_CONFIG_LEVEL_LABEL</label>
			            <description i18n="true">PLUGINS_CORE_SECURITY_CONFIG_LEVEL_DESCRIPTION</description>
			            <enumeration>
			                <entry>
			                    <label i18n="true">PLUGINS_CORE_SECURITY_CONFIG_LEVEL_LOW</label>
			                    <value>low</value>
			                </entry>
			                <entry>
			                    <label i18n="true">PLUGINS_CORE_SECURITY_CONFIG_LEVEL_HIGH</label>
			                    <value>high</value>
			                </entry>
			            </enumeration>
			            <validation>
			                <mandatory/>
			            </validation>
			            <default-value>low</default-value>
        			</param>
        		</parameters>
        	</extension>
        </extensions>
    </feature>
    
    <feature name="runtime.authentication.impl.remote">
    	<!-- 
            This feature defines the 'remote' credential provider (i.e. where the credential is automatically setted and trusted 
            by environment in the REMOTE_USER variable)
         -->
    	<extensions>
        	<extension id="org.ametys.core.authentication.Remote"
        			   class="org.ametys.core.authentication.DefaultCredentialProviderModel"
        			   point="org.ametys.core.authentication.CredentialProviderFactory"
        			   logger="org.ametys.plugins.core.impl.authentication.remote">
        		<class name="org.ametys.plugins.core.impl.authentication.RemoteUserCredentialProvider"/>
        		<label i18n="true">PLUGINS_CORE_AUTHENTICATION_REMOTE_LABEL</label>
        		<description i18n="true">PLUGINS_CORE_AUTHENTICATION_REMOTE_DESCRIPTION</description>
        		<parameters>
        			<param id="runtime.authentication.remote.header.name" type="string">
        				<!-- 
			                This parameter contains the request header name
			             -->
	        			<label i18n="true">PLUGINS_CORE_AUTHENTICATION_REMOTE_CONFIG_HEADER_NAME_LABEL</label>
	        			<description i18n="true">PLUGINS_CORE_AUTHENTICATION_REMOTE_CONFIG_HEADER_NAME_DESCRIPTION</description>
	        			<validation>
			                <mandatory/>
			            </validation>
			            <default-value>REMOTE_USER</default-value>
        			</param>
        			<param id="runtime.authentication.remote.realm" type="string">
        				<!-- 
			                This parameter contains the realm name
			             -->
			            <label i18n="true">PLUGINS_CORE_AUTHENTICATION_REMOTE_CONFIG_REALM_LABEL</label>
			            <description i18n="true">PLUGINS_CORE_AUTHENTICATION_REMOTE_CONFIG_REALM_DESCRIPTION</description>
        			</param>
        		</parameters>
        	</extension>
        </extensions>
    </feature>
        
    <!-- <feature name="runtime.authentication.impl.jcifs">
        
            This feature defines the windows NT credential provider.<br/>
            Use its extension to automatically get the login of the user connected on the NT domain : 
            user is authenticated externally and trusted by the NT environment.
        
        <config>
            <param-ref id="runtime.authentication.remote.realm"/>
            <param-ref id="runtime.authentication.jcifs.production"/>
            <param-ref id="runtime.authentication.jcifs.clientDomain"/>
            <param-ref id="runtime.authentication.jcifs.netBios"/>
            <param-ref id="runtime.authentication.jcifs.domainController"/>
        </config>
        <components>
            <component role="org.ametys.core.authentication.CredentialsProvider"
                       id="org.ametys.plugins.core.authentication.Jcifs"
                       class="org.ametys.plugins.core.impl.authentication.JcifsCredentialsProvider"
                       logger="org.ametys.plugins.core.impl.authentication.jcifs"/>
        </components>
    </feature> -->
    
    <feature name="runtime.authentication.impl.cas">
    	<!-- 
            This feature defines the 'cas' credential provider (i.e. user is authenticated externally and
            trusted by a CAS Server)
         -->
    	<!-- 
            The same as runtime.authentication.impl.cas but where CAS is configured to be used as a gateway :<br/>
            An already authenticated user is trusted but a new one can also connect !<br/>
            To give the user the oppotunity to enter its credentials you will have to manually redirect to the CAS login page.
            @see:plugin{feature/runtime.authentication.impl.cas}
            @see:plugin{config/runtime.authentication.cas.serverUrl}
         -->
    	<extensions>
        	<extension id="org.ametys.core.authentication.CAS"
        			   class="org.ametys.core.authentication.DefaultCredentialProviderModel"
        			   point="org.ametys.core.authentication.CredentialProviderFactory"
        			   logger="org.ametys.plugins.core.impl.authentication.cas">
        		<class name="org.ametys.plugins.core.impl.authentication.CASCredentialProvider"/>
        		<label i18n="true">PLUGINS_CORE_AUTHENTICATION_CAS_LABEL</label>
        		<description i18n="true">PLUGINS_CORE_AUTHENTICATION_CAS_DESCRIPTION</description>
        		<label-connection i18n="true">PLUGINS_CORE_AUTHENTICATION_CAS_CONNECTION_LABEL</label-connection>
        		<icon-glyph>flaticon-key162</icon-glyph>
        		<color>2d7149</color>
        		<parameters>
        			<param id="runtime.authentication.cas.serverUrl" type="string">
        				<!-- 
			                This parameter contains the url to reach the CAS server
			             -->
        				<label i18n="true">PLUGINS_CORE_AUTHENTICATION_CAS_CONFIG_URL_LABEL</label>
			            <description i18n="true">PLUGINS_CORE_AUTHENTICATION_CAS_CONFIG_URL_DESCRIPTION</description>
			            <validation>
			                <mandatory/>
			                <regexp>^https?://.*$</regexp>
			                <invalidText i18n="true">plugin.core:PLUGINS_CORE_REGEXP_INVALID_URL</invalidText>
			            </validation>
			            <default-value>https://servername</default-value>
        			</param>
        			<param id="runtime.authentication.cas.authorizedProxyChain" type="string">
        				<!-- 
			                This parameter contains the authorized proxy chain for CAS
			             -->
        				<label i18n="true">PLUGINS_CORE_AUTHENTICATION_CAS_CONFIG_AUTHORIZEDPROXY_LABEL</label>
            			<description i18n="true">PLUGINS_CORE_AUTHENTICATION_CAS_CONFIG_AUTHORIZEDPROXY_DESCRIPTION</description>
        			</param>
        		</parameters>
        	</extension>
        </extensions>
    </feature>
    
    <feature name="runtime.populations.datasource.client" safe="true">
        <extensions>
            <extension point="org.ametys.core.datasource.DataSourceConsumerExtensionPoint"
                       id="org.ametys.plugins.core.impl.user.population.PopulationDataSourceConsumer"
                       class="org.ametys.plugins.core.impl.user.population.PopulationDataSourceConsumer">
            </extension>
        </extensions>
    </feature>
    
    <feature name="runtime.context.population.client" safe="true">
    	<extensions>
            <extension point="org.ametys.core.user.population.PopulationConsumerExtensionPoint"
                       id="org.ametys.plugins.core.impl.user.population.ContextPopulationConsumer"
                       class="org.ametys.plugins.core.impl.user.population.ContextPopulationConsumer">
            </extension>
    	</extensions>
    </feature>
    
    <feature name="runtime.user.preferences.empty" safe="true">
        <!-- 
            A users'preferences manager that do not store anything. Usefull, if you do not user users prefs. 
        -->
        <components>
            <component role="org.ametys.core.userpref.DefaultUserPreferencesStorage"
                       id="org.ametys.plugins.core.userpref.EmptyUserPreferencesStorage"
                       class="org.ametys.plugins.core.impl.userpref.EmptyUserPreferencesStorage">
            </component>
        </components>
    </feature>
    
    <feature name="runtime.user.preferences.default" depends="core/runtime.core.sql.userprefs.init">
        <config>
            <param-ref id="runtime.usersprefs.datasource"/> 
        </config>
        <!-- 
            The main users'preferences manager implementation, that do store users'prefs into a sql db. 
        -->
        
        <components>
            <component role="org.ametys.core.userpref.DefaultUserPreferencesStorage"
                       id="org.ametys.plugins.core.userpref.JdbcXmlUserPreferencesStorage"
                       class="org.ametys.plugins.core.impl.userpref.JdbcXmlUserPreferencesStorage">
                <datasource type="config">runtime.usersprefs.datasource</datasource>
                <table>UserPreferences</table>
            </component>
        </components>
    </feature>
    
    <feature name="runtime.upload.manager.fs">
        <!--
            This feature defines components needed by the file system upload manager
         -->
        <components>
            <component role="org.ametys.core.upload.UploadManager"
                       id="org.ametys.plugins.core.upload.FSUploadManager"
                       class="org.ametys.plugins.core.impl.upload.FSUploadManager">
                <!-- UploadManager for storing uploaded files into Ametys home 'uploads-user' directory -->
            </component>
        </components>
    </feature>
    
    <!-- +
         |  VERSIONS
         + -->    
    <feature name="runtime.version" safe="true">       
        <components>
            <component  role="org.ametys.core.version.VersionsHandler" 
                        id="org.ametys.plugins.core.version.Default"
                        class="org.ametys.plugins.core.impl.version.DefaultVersionsHandler"
                        logger="org.ametys.plugins.core.plugins.core.versions"/>
        </components>
    </feature>
    
    <!-- +
         |  CURRENT USER PROVIDER
         + -->   
    <feature name="runtime.current-user" safe="true">
        <!-- 
            This feature provides a non-null current user
         -->
        <components>
            <!-- Default extension for providing the current user -->
            <component role="org.ametys.core.user.CurrentUserProvider"
                       id="org.ametys.plugins.core.user.AvalonCurrentUserProvider"
                       class="org.ametys.plugins.core.impl.user.AvalonCurrentUserProvider">
                <user default="admin"/>
            </component>
        </components>
    </feature>
    
    <feature name="runtime.rights.impl.basic" safe="true">
        <!-- 
            This feature declares the basic rights manager that always anwers OK
         -->
        <components>
            <component role="org.ametys.core.right.RightsManager"
                       id="org.ametys.plugins.core.right.Basic"
                       class="org.ametys.plugins.core.impl.right.BasicRightsManager"
                       logger="org.ametys.plugins.core.impl.right.basic"/>
        </components>
    </feature>

    <feature name="runtime.rights.impl.profil" depends="core/runtime.core.sql.profile.init">
        <!-- 
            This feature declares the profile based rights manager.<br/>
            This manager use the core database pool.
            A profile is a set of atomic rights.
         -->
        <config>
            <param-ref id="runtime.rights.datasource"/>
        </config>

        <components>
            <component role="org.ametys.core.right.RightsManager"
                       id="org.ametys.plugins.core.right.DefaultProfileBased"
                       class="org.ametys.plugins.core.impl.right.profile.DefaultProfileBasedRightsManager"
                       logger="org.ametys.plugins.core.impl.right.profil">
                <!--
                    See javadoc.<br/>
                    The configuration is handled in /WEB-INF/param/rights.xml.<br/>
                    The database pool is runtime.rights.datasource
                 -->
                <rights config="/WEB-INF/param/rights.xml"/>
                <datasource type="config">runtime.rights.datasource</datasource>
            </component>
        </components>
    </feature>

    <feature name="runtime.rights.impl.hierarchicalProfil" depends="core/runtime.core.sql.profile.init">
        <config>
            <param-ref id="runtime.rights.datasource"/>
        </config>
        <!-- 
            The same as runtime.rights.impl.profil but where rights are inherited in contexts :
            having the right on '/foo' gives the right on '/foo/subfoo'
            @see:plugin{feature/runtime.rights.impl.profil}
         -->
        <components>
            <component role="org.ametys.core.right.RightsManager"
                       id="org.ametys.plugins.core.right.HierarchicalProfileBased"
                       class="org.ametys.plugins.core.impl.right.profile.HierarchicalProfileBasedRightsManager"
                       logger="org.ametys.plugins.core.impl.right.hierarchicalprofil">
                <rights config="/WEB-INF/param/rights.xml"/>
                <datasource type="config">runtime.rights.datasource</datasource>
            </component>                       
        </components>
    </feature>
    
    <feature name="runtime.rights.context.impl.default" safe="true">
        <!-- 
            This feature declares the default rights context manager
         -->
        <components>
            <component role="org.ametys.core.right.RightsContextPrefixExtensionPoint"
                       id="org.ametys.plugins.core.right.context.Default"
                       class="org.ametys.plugins.core.impl.right.DefaultRightsContextPrefix"
                       logger="org.ametys.plugins.core.impl.right.context.default"/>
        </components>
    </feature>
    
    <!-- +
         | CONFIGURATION DATA SOURCE CLIENT 
         + -->
    <feature name="runtime.core.datasource.client" safe="true">
        <extensions>
            <extension point="org.ametys.core.datasource.DataSourceConsumerExtensionPoint"
                       id="org.ametys.plugins.core.impl.datasource.ConfigurationDataSourceConsumer"
                       class="org.ametys.plugins.core.impl.datasource.ConfigurationDataSourceConsumer">
            </extension>
        </extensions>
    </feature>
    
    <!-- +
         | HANDLED SQL DATABASE TYPES
         + -->
          
    <!-- Derby -->
    <feature name="runtime.core.datasources.sql.derby" safe="true">
        <extensions>
            <extension point="org.ametys.core.datasource.dbtype.SQLDatabaseTypeExtensionPoint"
                       id="org.ametys.core.datasource.sql.dbtype.derby"
                       class="org.ametys.plugins.core.impl.datasource.StaticSQLDatabaseType">
                 <driver>org.apache.derby.jdbc.EmbeddedDriver</driver>
                 <label i18n="true">PLUGINS_CORE_DATASOURCE_DERBY_DRIVER_LABEL</label>
                 <template>jdbc:derby:&lt;path&gt;;create=true</template>
                 <driver-not-found-message i18n="true">PLUGINS_CORE_DATASOURCE_DRIVER_NOT_FOUND</driver-not-found-message>
            </extension>
        </extensions>
    </feature>
    
    <!-- MySQL -->
    <feature name="runtime.core.datasources.sql.mysql" safe="true">
        <extensions>        
            <extension point="org.ametys.core.datasource.dbtype.SQLDatabaseTypeExtensionPoint"
                       id="org.ametys.core.datasource.sql.dbtype.mysql"
                       class="org.ametys.plugins.core.impl.datasource.StaticSQLDatabaseType">
                 <driver>com.mysql.jdbc.Driver</driver>
                 <label i18n="true">PLUGINS_CORE_DATASOURCE_MYSQL_DRIVER_LABEL</label>
                 <template>jdbc:mysql://&lt;hostname&gt;[&lt;:3306&gt;]/&lt;dbname&gt;</template>
                 <driver-not-found-message i18n="true">PLUGINS_CORE_DATASOURCE_DRIVER_NOT_FOUND</driver-not-found-message>
            </extension>
        </extensions>
    </feature>
       
    <!-- HSQL -->
    <feature name="runtime.core.datasources.sql.hsql" safe="true">
        <extensions>
            <extension point="org.ametys.core.datasource.dbtype.SQLDatabaseTypeExtensionPoint"
                       id="org.ametys.core.datasource.sql.dbtype.hsql"
                       class="org.ametys.plugins.core.impl.datasource.StaticSQLDatabaseType">
                 <driver>org.hsqldb.jdbc.JDBCDriver</driver>
                 <label i18n="true">PLUGINS_CORE_DATASOURCE_HSQL_DRIVER_LABEL</label>
                 <template>jdbc:hsqldb:&lt;path&gt;</template>
                 <driver-not-found-message i18n="true">PLUGINS_CORE_DATASOURCE_DRIVER_NOT_FOUND</driver-not-found-message>
            </extension>
        </extensions>
    </feature>
    
    <!-- PostGreSQL -->
    <feature name="runtime.core.datasources.sql.postgresql" safe="true">
        <extensions>        
            <extension point="org.ametys.core.datasource.dbtype.SQLDatabaseTypeExtensionPoint"
                       id="org.ametys.core.datasource.sql.dbtype.postgresql"
                       class="org.ametys.plugins.core.impl.datasource.StaticSQLDatabaseType">
                 <driver>org.postgresql.Driver</driver>
                 <label i18n="true">PLUGINS_CORE_DATASOURCE_POSTGRESQL_DRIVER_LABEL</label>
                 <template>jdbc:postgresql://&lt;hostname&gt;[&lt;:port&gt;]/&lt;dbname&gt;</template>
                 <driver-not-found-message i18n="true">PLUGINS_CORE_DATASOURCE_DRIVER_NOT_FOUND</driver-not-found-message>
            </extension>
        </extensions>
    </feature>
    
    <!-- Oracle -->
    <feature name="runtime.core.datasources.sql.oracle" safe="true">
        <extensions>
            <extension point="org.ametys.core.datasource.dbtype.SQLDatabaseTypeExtensionPoint"
                       id="org.ametys.core.datasource.sql.dbtype.oracle"
                       class="org.ametys.plugins.core.impl.datasource.StaticSQLDatabaseType">
                 <driver>oracle.jdbc.driver.OracleDriver</driver>
                 <label i18n="true">PLUGINS_CORE_DATASOURCE_ORACLE_DRIVER_LABEL</label>
                 <template>jdbc:oracle:thin:@&lt;hostname&gt;:&lt;port&gt;:&lt;sid&gt;</template>
                 <driver-not-found-message i18n="true">PLUGINS_CORE_DATASOURCE_ORACLE_DRIVER_NOT_FOUND</driver-not-found-message>
            </extension>
        </extensions>
    </feature>
    
    <feature name="runtime.core.schedule.sendMail">
        <extensions>
            <extension id="org.ametys.core.schedule.SendMail"
                       class="org.ametys.plugins.core.impl.schedule.SendMailSchedulable"
                       point="org.ametys.core.schedule.SchedulableExtensionPoint">
                <label i18n="true">PLUGINS_CORE_SCHEDULER_SEND_MAIL_LABEL</label>
                <description i18n="true">PLUGINS_CORE_SCHEDULER_SEND_MAIL_DESCRIPTION</description>
                <icon-glyph>flaticon-envelope14</icon-glyph>
                <parameters>
                    <param id="sender" type="string">
                        <label i18n="true">PLUGINS_CORE_SCHEDULER_SEND_MAIL_SENDER_LABEL</label>
                        <description i18n="true">PLUGINS_CORE_SCHEDULER_SEND_MAIL_SENDER_DESCRIPTION</description>
                        <validation>
                            <regexp>^(\w+)([\-+.][\w]+)*@(\w[\-\w]*\.){1,5}([A-Za-z0-9][A-Za-z0-9]+)$</regexp>
                            <invalidText i18n="true">plugin.core:PLUGINS_CORE_REGEXP_INVALID_MAIL</invalidText>
                            <mandatory/>
                        </validation>
                    </param>
                    <param id="recipients" type="string">
                        <label i18n="true">PLUGINS_CORE_SCHEDULER_SEND_MAIL_RECIPIENTS_LABEL</label>
                        <description i18n="true">PLUGINS_CORE_SCHEDULER_SEND_MAIL_RECIPIENTS_DESCRIPTION</description>
                        <validation>
                            <regexp>^(\w+)([\-+.][\w]+)*@(\w[\-\w]*\.){1,5}([A-Za-z0-9][A-Za-z0-9]+)( (\w+)([\-+.][\w]+)*@(\w[\-\w]*\.){1,5}([A-Za-z0-9][A-Za-z0-9]+))*$</regexp>
                            <invalidText i18n="true">plugin.core:PLUGINS_CORE_REGEXP_INVALID_MAIL</invalidText>
                            <mandatory/>
                        </validation>
                    </param>
                    <param id="subject" type="string">
                        <label i18n="true">PLUGINS_CORE_SCHEDULER_SEND_MAIL_SUBJECT_LABEL</label>
                        <description i18n="true">PLUGINS_CORE_SCHEDULER_SEND_MAIL_SUBJECT_DESCRIPTION</description>
                        <validation>
                            <mandatory/>
                        </validation>
                    </param>
                    <param id="body" type="string">
                        <label i18n="true">PLUGINS_CORE_SCHEDULER_SEND_MAIL_BODY_LABEL</label>
                        <description i18n="true">PLUGINS_CORE_SCHEDULER_SEND_MAIL_BODY_DESCRIPTION</description>
                        <validation>
                            <mandatory/>
                        </validation>
                        <widget>edition.textarea</widget>
                    </param>
                </parameters>
            </extension>
        </extensions>
    </feature>
    
    <feature name="runtime.core.schedule.executeScript">
        <extensions>
            <extension id="org.ametys.core.schedule.Script"
                       class="org.ametys.plugins.core.impl.schedule.ScriptSchedulable"
                       point="org.ametys.core.schedule.SchedulableExtensionPoint">
                <label i18n="true">PLUGINS_CORE_SCHEDULER_EXECUTE_SCRIPT_LABEL</label>
                <description i18n="true">PLUGINS_CORE_SCHEDULER_EXECUTE_SCRIPT_DESCRIPTION</description>
                <icon-glyph>flaticon-computer196</icon-glyph>
                <parameters>
                    <param id="script" type="string">
                        <label i18n="true">PLUGINS_CORE_SCHEDULER_EXECUTE_SCRIPT_CODE_LABEL</label>
                        <description i18n="true">PLUGINS_CORE_SCHEDULER_EXECUTE_SCRIPT_CODE_DESCRIPTION</description>
                        <validation>
                            <mandatory/>
                        </validation>
                        <widget>edition.code</widget>
                        <widget-params>
                            <param name="mode">javascript</param>
                        </widget-params>
                    </param>
                </parameters>
            </extension>
        </extensions>
    </feature>
</plugin>